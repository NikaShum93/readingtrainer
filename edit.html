<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–†–µ–¥–∞–∫—Ç–æ—Ä (ID + JSON) ‚Äî Reading Trainer</title>
<link id="gfLink" rel="stylesheet">
<style>
  :root { --panel:#261635d9; --border:#a85ad9; --ink:#e0d1f9; }
  *{box-sizing:border-box}
  body{ min-height:100vh;margin:0;background:radial-gradient(ellipse at 50% 25%, #232135 60%, #141025 100%); color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; padding:24px }
  h1{ text-align:center; font-size:2.1em; margin:6px 0 0; color:#c7a3fa; text-shadow:0 2px 24px #a276ff66 }
  .subtitle{ text-align:center; color:#ecc2ff; margin:6px 0 22px; }
  .panel{ max-width:1000px;margin:0 auto;background:var(--panel);border:2.5px solid var(--border); border-radius:22px; padding:22px; box-shadow:0 8px 32px #3e146066 }
  label{ display:block; margin:14px 0 6px; font-weight:700 }
  input[type=text], textarea, select, input[type=number], input[type=range]{ width:100%; background:#27173a; border:1.5px solid #6c4797; color:#e6d7fa; border-radius:10px; padding:10px 12px; font-size:15px; box-shadow: inset 0 0 8px #3e146033 }
  textarea{ min-height:110px; resize:vertical }
  .row{ display:flex; gap:16px; align-items:flex-start; flex-wrap:wrap }
  .col{ flex:1; min-width:260px }
  .color-row{ display:flex; align-items:center; gap:12px }
  .swatch{ width:34px;height:34px;border-radius:8px;border:2.5px solid #d5c5f7; cursor:pointer; box-shadow:0 1px 4px #6c4797aa }
  input[type=color]{ display:none }
  .helpers{ display:flex; gap:10px; flex-wrap:wrap; margin-top:8px }
  .toggle{ display:flex; align-items:center; gap:8px; background:#2a1a3f; border:1px solid #6c4797; padding:8px 10px; border-radius:10px }
  .out-wrap{ margin-top:14px; background:#20112a; border:1.5px solid #b888fa; border-radius:10px; padding:0; }
  #out{ width:100%; min-height:110px; resize:vertical; background:transparent; border:none; outline:none; color:#e6d7fa; font-family:monospace; font-size:14px; line-height:1.4; padding:12px; white-space:pre; overflow:auto; }
  .btn{ width:100%; margin-top:10px; padding:12px; border:none; border-radius:12px; cursor:pointer; background:linear-gradient(90deg,#c378f6 15%,#7c52c8 100%); color:#fff; font-weight:700; box-shadow:0 1px 18px #9f50b380 }
  .btn:hover{ background:linear-gradient(90deg,#ecc2ff 10%,#a46fff 90%); color:#452b60 }
  .note{ opacity:.85; font-size:.9em; margin-top:6px }
  .preview-iframe{ margin-top:14px; border:1px dashed #8e6ad6; border-radius:12px; padding:10px }
</style>
</head>
<body>
  <h1>–¢—Ä–µ–Ω–∞–∂—ë—Ä –ø–æ —á—Ç–µ–Ω–∏—é ‚Äî –†–µ–¥–∞–∫—Ç–æ—Ä (ID + JSON)</h1>
  <div class="subtitle">1) –°–∫–∞—á–∞–π JSON ‚Üí –ø–æ–ª–æ–∂–∏ –≤ <b>readingtrainer/data/</b> ‚Ä¢ 2) –í—Å—Ç–∞–≤—å iframe –Ω–∏–∂–µ</div>

  <div class="panel">
    <label for="id">ID (–ª–∞—Ç–∏–Ω–∏—Ü–µ–π, —Ü–∏—Ñ—Ä—ã –∏ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏—è)</label>
    <input type="text" id="id" value="autumn_magic_01" pattern="[A-Za-z0-9_\-]{1,64}" />

    <label for="title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
    <input type="text" id="title" value="–í–æ–ª—à–µ–±–Ω–∞—è –æ—Å–µ–Ω—å" maxlength="150">

    <label for="text">–¢–µ–∫—Å—Ç</label>
    <textarea id="text">–û—Å–µ–Ω—å ‚Äî –≤—Ä–µ–º—è –≤–æ–ª—à–µ–±—Å—Ç–≤–∞ –∏ —á—É–¥–µ—Å. –õ–∏—Å—Ç—å—è –º–µ–Ω—è—é—Ç —Ü–≤–µ—Ç, –∞ –≤–æ–∑–¥—É—Ö —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º –∏ —Å–≤–µ–∂–∏–º. –í —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥ –ø—Ä–∏—Ä–æ–¥–∞ –±—É–¥—Ç–æ –±—ã –∑–∞–º–∏—Ä–∞–µ—Ç –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ –Ω–æ–≤—ã—Ö —á—É–¥–µ—Å.</textarea>

    <!-- –®–†–ò–§–¢–´ / –¶–í–ï–¢–ê / –û–§–û–†–ú–õ–ï–ù–ò–ï -->
    <div class="row">
      <div class="col">
        <label for="fontFamily">CSS-—à—Ä–∏—Ñ—Ç (–∫–∞–∫ –≤ main)</label>
        <input type="text" id="fontFamily" value="'Georgia', serif">
        <div class="note">–ú–æ–∂–Ω–æ —Å–≤—è–∑–∞—Ç—å —Å Google Fonts —á–µ—Ä–µ–∑ CSS –ø—Ä–æ–µ–∫—Ç–∞. (–ö–∞—Ç–∞–ª–æ–≥ —à—Ä–∏—Ñ—Ç–æ–≤ —É–±—Ä–∞–ª–∞ —Ä–∞–¥–∏ –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏; –≤–µ—Ä–Ω—É ‚Äî —Å–∫–∞–∂–∏.)</div>
      </div>
      <div class="col">
        <label>–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ (px)</label>
        <input type="number" id="fontSize" min="16" max="72" value="28">
      </div>
      <div class="col">
        <label>–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
        <div class="color-row"><div class="swatch" id="textColorBox"></div><input type="color" id="textColor" value="#fff8e1"></div>
      </div>
    </div>

    <div class="row">
      <div class="col">
        <label>–¶–≤–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞</label>
        <div class="color-row"><div class="swatch" id="titleColorBox"></div><input type="color" id="titleColor" value="#ffd700"></div>
      </div>
      <div class="col">
        <label>–¶–≤–µ—Ç –ø–æ–¥—Å–≤–µ—Ç–∫–∏</label>
        <div class="color-row"><div class="swatch" id="highlightColorBox"></div><input type="color" id="highlightColor" value="#3a60ff"></div>
      </div>
      <div class="col">
        <label for="highlightStyle">–¢–∏–ø –ø–æ–¥—Å–≤–µ—Ç–∫–∏</label>
        <select id="highlightStyle"><option value="background">–§–æ–Ω —Å–ª–æ–≤–∞</option><option value="text">–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</option></select>
      </div>
    </div>

    <div class="row">
      <div class="col">
        <label>–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫–∏ (0‚Äì1)</label>
        <input type="range" id="highlightOpacity" min="0" max="1" step="0.05" value="1">
      </div>
      <div class="col">
        <label>–§–æ–Ω ‚Äî —Ü–≤–µ—Ç</label>
        <div class="color-row"><div class="swatch" id="bgColorBox"></div><input type="color" id="bgColor" value="#231111"></div>
      </div>
      <div class="col">
        <label>–§–æ–Ω ‚Äî –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (0‚Äì1)</label>
        <input type="range" id="bgOpacity" min="0" max="1" step="0.05" value="0.25">
      </div>
    </div>

    <div class="row">
      <div class="col">
        <label class="toggle"><input type="checkbox" id="noBorder"> –ë–µ–∑ —Ä–∞–º–∫–∏</label>
      </div>
      <div class="col">
        <label>–¶–≤–µ—Ç —Ä–∞–º–∫–∏</label>
        <div class="color-row"><div class="swatch" id="borderColorBox"></div><input type="color" id="borderColor" value="#ffd700"></div>
      </div>
      <div class="col">
        <label>–°–∫—Ä—É–≥–ª–µ–Ω–∏–µ —Ä–∞–º–∫–∏ (px)</label>
        <input type="number" id="borderRadius" min="0" max="1000" value="18">
      </div>
    </div>

    <!-- –ü–†–ê–í–ê IFRAME / –†–ê–ó–ú–ï–† -->
    <div class="row">
      <div class="col">
        <label class="toggle"><input type="checkbox" id="allowMic" checked> –ú–∏–∫—Ä–æ—Ñ–æ–Ω</label>
        <label class="toggle"><input type="checkbox" id="allowAutoplay" checked> –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫</label>
        <label class="toggle"><input type="checkbox" id="allowFs" checked> allowfullscreen</label>
        <label class="toggle"><input type="checkbox" id="cacheBust"> –û–±—Ö–æ–¥ –∫–µ—à–∞</label>
      </div>
      <div class="col">
        <label>–®–∏—Ä–∏–Ω–∞ iframe</label><input type="number" id="fw" value="900" min="300" max="3000">
      </div>
      <div class="col">
        <label>–í—ã—Å–æ—Ç–∞ iframe</label><input type="number" id="fh" value="520" min="200" max="3000">
      </div>
    </div>

    <div class="helpers">
      <button class="btn" id="downloadJsonBtn">üíæ –°–∫–∞—á–∞—Ç—å JSON</button>
    </div>

    <div class="out-wrap"><textarea id="out" readonly></textarea></div>
    <button class="btn" id="copyBtn">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å iframe</button>

    <div class="preview-iframe">
      <div class="note">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ ID (–ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ JSON –≤ —Ä–µ–ø–æ):</div>
      <iframe id="livePreview" style="width:100%;height:420px;border:none;border-radius:12px;overflow:hidden;" allow="microphone; autoplay"></iframe>
    </div>
  </div>

<script>
const BASE_URL = 'https://nikashum93.github.io/readingtrainer/main.html';

const pickers = ['textColor','titleColor','highlightColor','bgColor','borderColor'];
function initColor(boxId,inputId){ const box=document.getElementById(boxId), input=document.getElementById(inputId); box.style.background=input.value; box.addEventListener('click',()=>input.click()); input.addEventListener('input',()=>{box.style.background=input.value; render();}); }
pickers.forEach(id=>initColor(id+'Box',id));

['id','title','text','fontFamily','fontSize','textColor','titleColor','highlightColor','highlightOpacity','highlightStyle','bgColor','bgOpacity','borderColor','borderRadius','fw','fh'].forEach(id=>document.getElementById(id).addEventListener('input',render));
['noBorder','allowMic','allowAutoplay','allowFs','cacheBust'].forEach(id=>document.getElementById(id).addEventListener('change',render));

function buildJson(){
  const data = {
    id: val('id'),
    title: val('title'),
    text: val('text'),
    fontFamily: val('fontFamily'),
    fontSize: num('fontSize'),
    textColor: val('textColor'),
    titleColor: val('titleColor'),
    highlightColor: val('highlightColor'),
    highlightOpacity: parseFloat(val('highlightOpacity')),
    highlightStyle: val('highlightStyle'),
    bgColor: val('bgColor'),
    bgOpacity: parseFloat(val('bgOpacity')),
    border: checked('noBorder') ? 'none' : 'solid',
    borderColor: checked('noBorder') ? '' : val('borderColor'),
    borderRadius: num('borderRadius')
  };
  return data;
}
function val(id){ return document.getElementById(id).value; }
function num(id){ return parseInt(document.getElementById(id).value)||0; }
function checked(id){ return document.getElementById(id).checked; }

function downloadJson(){
  const data = buildJson();
  const id = data.id.trim();
  if(!/^[A-Za-z0-9_\-]{1,64}$/.test(id)){ alert('ID: –ª–∞—Ç–∏–Ω–∏—Ü–∞/—Ü–∏—Ñ—Ä—ã/–ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏—è, –¥–æ 64 —Å–∏–º–≤–æ–ª–æ–≤'); return; }
  const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = `${id}.json`;
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
}

function buildIframe(){
  const id = val('id').trim();
  if(!id){ return ''; }
  const qs = [
    `id=${encodeURIComponent(id)}`,
    `fontFamily=${encodeURIComponent(val('fontFamily'))}`,
    `fontSize=${encodeURIComponent(val('fontSize'))}`,
    `textColor=${encodeURIComponent(val('textColor'))}`,
    `titleColor=${encodeURIComponent(val('titleColor'))}`,
    `highlightColor=${encodeURIComponent(val('highlightColor'))}`,
    `highlightOpacity=${encodeURIComponent(val('highlightOpacity'))}`,
    `highlightStyle=${encodeURIComponent(val('highlightStyle'))}`,
    `bgColor=${encodeURIComponent(val('bgColor'))}`,
    `bgOpacity=${encodeURIComponent(val('bgOpacity'))}`,
    `border=${checked('noBorder')?'none':'solid'}`,
    `borderColor=${encodeURIComponent(checked('noBorder')?'':val('borderColor'))}`,
    `borderRadius=${encodeURIComponent(val('borderRadius'))}`
  ];
  if (checked('cacheBust')) qs.push(`v=${Date.now()}`);
  const src = `${BASE_URL}?${qs.join('&')}`;
  const allow = [
    checked('allowMic') ? 'microphone' : '',
    checked('allowAutoplay') ? 'autoplay' : ''
  ].filter(Boolean).join('; ');
  const allowAttr = allow ? ` allow="${allow}"` : '';
  const fsAttr = checked('allowFs') ? ' allowfullscreen' : '';
  return `<iframe src="${src}" width="${val('fw')}" height="${val('fh')}" style="border:none;border-radius:16px;overflow:hidden;"${allowAttr}${fsAttr}></iframe>`;
}

function render(){
  const code = buildIframe();
  document.getElementById('out').value = code;
  // live preview
  const lp = document.getElementById('livePreview');
  const srcMatch = code.match(/src="([^"]+)"/);
  if (srcMatch) lp.src = srcMatch[1]; else lp.removeAttribute('src');
}
document.getElementById('downloadJsonBtn').addEventListener('click', downloadJson);
document.getElementById('copyBtn').addEventListener('click', async ()=>{
  const text = document.getElementById('out').value.trim();
  try{ await navigator.clipboard.writeText(text); }catch{ const ta=document.getElementById('out'); ta.focus(); ta.select(); document.execCommand('copy'); }
  const btn = document.getElementById('copyBtn'); const old=btn.textContent; btn.textContent='‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ'; setTimeout(()=>btn.textContent=old,1200);
});
render();
</script>
</body>
</html>
