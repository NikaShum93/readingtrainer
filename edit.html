<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Grimoire of Reading ‚Äî —Ä–µ–¥–∞–∫—Ç–æ—Ä</title>
<link id="gfLink" rel="stylesheet" href="">
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0e1a15; --card:#11251e; --card-hover:#142b23;
    --ink:#e9f2e9; --ink-d:#cfe2d2; --line:#1e3e30; --accent:#34d399;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%}
  body{background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
  header{padding:24px 16px 8px;text-align:center}
  h1{margin:0;font-size:clamp(22px,3.4vw,38px);font-family:"Cinzel Decorative",serif;color:#bfffe3;text-shadow:0 0 18px #1c6e52}
  .wrap{max-width:1160px;margin:0 auto;padding:0 16px 28px;display:grid;gap:16px}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  @media (max-width:980px){ .grid2{grid-template-columns:1fr} }
  .card{background:var(--card);border-radius:12px;padding:16px 14px;transition:background .2s ease}
  .card:hover{background:var(--card-hover)}
  .card h2{margin:0 0 10px;font-size:18px;color:#b2f2da}
  .row{display:grid;grid-template-columns:220px 1fr;gap:10px;align-items:center;margin:10px 0}
  @media (max-width:720px){ .row{grid-template-columns:1fr} }
  label.lbl{color:#b2f2da;font-weight:800}
  input,textarea,select{width:100%;background:#0a1c15;color:var(--ink);border:1.5px solid #164632;border-radius:10px;padding:10px 12px}
  textarea{min-height:110px;resize:vertical}
  .sw{display:flex;align-items:center;gap:10px}
  .swatch{width:34px;height:34px;border-radius:8px;border:2px solid #2a6b4f;cursor:pointer;box-shadow:0 2px 8px #052019aa}
  input[type=color].picker{position:absolute;opacity:0;width:0;height:0;border:0;padding:0}
  .value{min-width:46px;text-align:right;color:var(--ink-d);font-variant-numeric:tabular-nums}
  .toggle{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid #1f4b37;background:#0b1f17;border-radius:10px}
  .stack{display:flex;gap:10px;flex-wrap:wrap}
  .btn{background:linear-gradient(90deg,#20c997 0,#10b981 100%);color:#083a2b;border:none;border-radius:10px;padding:10px 14px;font-weight:900;cursor:pointer}
  .status{padding:10px;border-radius:10px;background:#0c2018;border:1px solid #214d39;display:none}
  .ok{color:#b8ffd6}.bad{color:#ffbbbb}.warn{color:#ffe3a6}
  .code{border-radius:10px;background:#0a1e17}
  #out{width:100%;min-height:90px;border:none;background:transparent;color:var(--ink);padding:12px;font-family:ui-monospace,Consolas,monospace;white-space:pre}
  iframe{width:100%;height:440px;border:none;border-radius:12px}
</style>
</head>
<body>
<header><h1>Grimoire of Reading ‚Äî —Ä–µ–¥–∞–∫—Ç–æ—Ä</h1></header>

<div class="wrap">

  <!-- –¢–µ–∫—Å—Ç -->
  <section class="card">
    <h2>–¢–µ–∫—Å—Ç</h2>
    <div class="row">
      <label class="lbl" for="title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
      <input id="title" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Autumn Days" value="Autumn Days">
    </div>
    <div class="row">
      <label class="lbl" for="text">–û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç</label>
      <textarea id="text" placeholder="–ê–±–∑–∞—Ü—ã —Ä–∞–∑–¥–µ–ª—è–π –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π">The days grow colder and the nights grow longer. Leaves change their colour ‚Äî from green to gold, orange, and red.

The wind blows softly through the trees, making the branches sway. Children play outside, kicking leaves high into the air.

Sometimes a cloud hides the pale sun, and rain begins to fall. In the evening, families stay inside, drinking hot cocoa and telling stories by the fire.

Autumn is a time of change ‚Äî a bright and cosy season before the snow.</textarea>
    </div>
  </section>

  <div class="grid2">

    <!-- –®—Ä–∏—Ñ—Ç/—Ü–≤–µ—Ç -->
    <section class="card">
      <h2>–®—Ä–∏—Ñ—Ç –∏ —Ü–≤–µ—Ç</h2>
      <div class="row">
        <label class="lbl" for="fontPreset">–ì–∞—Ä–Ω–∏—Ç—É—Ä–∞</label>
        <select id="fontPreset"></select>
      </div>
      <div class="row">
        <label class="lbl" for="fontSize">–†–∞–∑–º–µ—Ä (px)</label>
        <input type="number" id="fontSize" min="16" max="72" value="28">
      </div>
      <div class="row">
        <label class="lbl">–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
        <div class="sw">
          <div id="textColorBox" class="swatch"></div>
          <input id="textColor" class="picker" type="color" value="#fff8e1">
        </div>
      </div>
    </section>

    <!-- –ü–æ–¥—Å–≤–µ—Ç–∫–∞ -->
    <section class="card">
      <h2>–ü–æ–¥—Å–≤–µ—Ç–∫–∞</h2>
      <div class="row">
        <label class="lbl">–¶–≤–µ—Ç –ø–æ–¥—Å–≤–µ—Ç–∫–∏</label>
        <div class="sw">
          <div id="highlightColorBox" class="swatch"></div>
          <input id="highlightColor" class="picker" type="color" value="#ffd700">
        </div>
      </div>
      <div class="row">
        <label class="lbl" for="highlightOpacity">–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫–∏</label>
        <div style="display:flex;align-items:center;gap:10px">
          <input id="highlightOpacity" type="range" min="0" max="1" step="0.05" value="0.30" style="flex:1">
          <span id="hoVal" class="value">0.30</span>
        </div>
      </div>
      <div class="row">
        <label class="lbl">–¢–∏–ø –ø–æ–¥—Å–≤–µ—Ç–∫–∏</label>
        <input disabled value="–ü–æ–¥–ª–æ–∂–∫–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)" />
      </div>
    </section>

  </div>

  <div class="grid2">
    <!-- –§–æ–Ω –∏ —Ä–∞–º–∫–∞ -->
    <section class="card">
      <h2>–§–æ–Ω –∏ —Ä–∞–º–∫–∞</h2>
      <div class="row">
        <label class="lbl">–§–æ–Ω ‚Äî —Ü–≤–µ—Ç</label>
        <div class="sw">
          <div id="bgColorBox" class="swatch"></div>
          <input id="bgColor" class="picker" type="color" value="#0b271f">
        </div>
      </div>
      <div class="row">
        <label class="lbl" for="bgOpacity">–§–æ–Ω ‚Äî –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å</label>
        <div style="display:flex;align-items:center;gap:10px">
          <input id="bgOpacity" type="range" min="0" max="1" step="0.05" value="0.75" style="flex:1">
          <span id="boVal" class="value">0.75</span>
        </div>
      </div>
      <div class="row">
        <label class="lbl">–¶–≤–µ—Ç —Ä–∞–º–∫–∏</label>
        <div class="sw">
          <div id="borderColorBox" class="swatch"></div>
          <input id="borderColor" class="picker" type="color" value="#34d399">
        </div>
      </div>
      <div class="row">
        <label class="lbl" for="borderRadius">–°–∫—Ä—É–≥–ª–µ–Ω–∏–µ (0‚Äì1000)</label>
        <input type="number" id="borderRadius" min="0" max="1000" value="18">
      </div>
      <div class="row">
        <label class="lbl">–û–ø—Ü–∏–∏</label>
        <label class="toggle"><input type="checkbox" id="noBorder"> –±–µ–∑ —Ä–∞–º–∫–∏</label>
      </div>
    </section>

    <!-- –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ -->
    <section class="card">
      <h2>–í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ</h2>
      <div class="row">
        <label class="lbl" for="fw">–®–∏—Ä–∏–Ω–∞ iframe</label>
        <input type="number" id="fw" value="900" min="300" max="3000">
      </div>
      <div class="row">
        <label class="lbl" for="fh">–í—ã—Å–æ—Ç–∞ iframe</label>
        <input type="number" id="fh" value="520" min="200" max="3000">
      </div>
      <div class="row">
        <label class="lbl">–†–∞–∑—Ä–µ—à–µ–Ω–∏—è</label>
        <div class="stack">
          <label class="toggle"><input type="checkbox" id="allowMic" checked> microphone</label>
          <label class="toggle"><input type="checkbox" id="allowAutoplay" checked> autoplay</label>
          <label class="toggle"><input type="checkbox" id="allowFs" checked> allowfullscreen</label>
        </div>
      </div>

      <div class="stack" style="margin-top:8px">
        <button class="btn" id="publishBtn" type="button">üß™ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å JSON</button>
        <button class="btn" id="copyBtn" type="button">üìã –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å IFRAME</button>
      </div>
      <div class="status" id="status"></div>
    </section>
  </div>

  <!-- –ö–æ–¥ –∏ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
  <section class="card">
    <h2>–ö–æ–¥ –∏ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h2>
    <div class="code"><textarea id="out" readonly></textarea></div>
    <iframe id="preview" allow="microphone; autoplay"></iframe>
  </section>
</div>

<script>
/* ===== –ö–æ–Ω—Ñ–∏–≥ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ ===== */
const ENDPOINT    = "https://server-kjnn.onrender.com/publish";
const PUBLISH_KEY = "nika_read_pub_2025";
const BASE_MAIN   = "https://nikashum93.github.io/readingtrainer/main.html";

/* ===== –°–æ—Å—Ç–æ—è–Ω–∏–µ ===== */
let LAST_ID = localStorage.getItem('rt_last_id') || ""; // —Ñ–∏–∫—Å–∏—Ä—É–µ–º id –ø–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

/* ===== –£—Ç–∏–ª–∏—Ç—ã ===== */
const $ = id => document.getElementById(id);
const statusBox = $("status");
function setStatus(html, cls=''){ statusBox.style.display='block'; statusBox.className='status '+cls; statusBox.innerHTML=html; }
function slug(s){return (s||'untitled').toString().toLowerCase().normalize('NFKD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'').slice(0,40)||'note'}
function stamp(){const d=new Date(),p=n=>String(n).padStart(2,'0');return`${d.getFullYear()}${p(d.getMonth()+1)}${p(d.getDate())}-${p(d.getHours())}${p(d.getMinutes())}${p(d.getSeconds())}`}

/* ===== –®—Ä–∏—Ñ—Ç—ã ===== */
const FONTS = [
  {group:'–ß–∏—Ç–∞–±–µ–ª—å–Ω—ã–µ (UI, –∫–∏—Ä–∏–ª–ª–∏—Ü–∞)', items:[
    {name:'Inter', css:"'Inter', system-ui, Arial, sans-serif", gf:"family=Inter:wght@400;700&display=swap"},
    {name:'Roboto', css:"'Roboto', Arial, sans-serif", gf:"family=Roboto:wght@400;700&display=swap"},
    {name:'Montserrat', css:"'Montserrat', Arial, sans-serif", gf:"family=Montserrat:wght@400;700&display=swap"},
    {name:'Nunito', css:"'Nunito', Arial, sans-serif", gf:"family=Nunito:wght@400;700&display=swap"},
    {name:'Rubik', css:"'Rubik', Arial, sans-serif", gf:"family=Rubik:wght@400;700&display=swap"},
    {name:'PT Sans', css:"'PT Sans', Arial, sans-serif", gf:"family=PT+Sans:wght@400;700&display=swap"},
    {name:'Source Sans 3', css:"'Source Sans 3', Arial, sans-serif", gf:"family=Source+Sans+3:wght@400;700&display=swap"},
    {name:'Ubuntu', css:"'Ubuntu', Arial, sans-serif", gf:"family=Ubuntu:wght@400;700&display=swap"},
    {name:'Fira Sans', css:"'Fira Sans', Arial, sans-serif", gf:"family=Fira+Sans:wght@400;700&display=swap"},
    {name:'Lexend', css:"'Lexend', Arial, sans-serif", gf:"family=Lexend:wght@400;700&display=swap"}
  ]},
  {group:'–°–µ—Ä–∏—Ñ (–∫–Ω–∏–≥–∏, –∫–∏—Ä–∏–ª–ª–∏—Ü–∞)', items:[
    {name:'Merriweather', css:"'Merriweather', Georgia, serif", gf:"family=Merriweather:wght@400;700&display=swap"},
    {name:'PT Serif', css:"'PT Serif', Georgia, serif", gf:"family=PT+Serif:wght@400;700&display=swap"},
    {name:'Playfair Display', css:"'Playfair Display', Georgia, serif", gf:"family=Playfair+Display:wght@400;700&display=swap"},
    {name:'Literata', css:"'Literata', Georgia, serif", gf:"family=Literata:wght@400;700&display=swap"}
  ]},
  {group:'–†—É–∫–æ–ø–∏—Å–Ω—ã–µ (–µ—Å—Ç—å –∫–∏—Ä–∏–ª–ª–∏—Ü–∞)', items:[
    {name:'Caveat', css:"'Caveat', cursive", gf:"family=Caveat:wght@400;700&display=swap"},
    {name:'Marck Script', css:"'Marck Script', cursive", gf:"family=Marck+Script&display=swap"},
    {name:'Neucha', css:"'Neucha', cursive", gf:"family=Neucha&display=swap"},
    {name:'Pacifico', css:"'Pacifico', cursive", gf:"family=Pacifico&display=swap"},
    {name:'Lobster', css:"'Lobster', cursive", gf:"family=Lobster&display=swap"},
    {name:'Comfortaa', css:"'Comfortaa', cursive", gf:"family=Comfortaa:wght@400;700&display=swap"}
  ]},
  {group:'–ú—É–ª—å—Ç—è—à–Ω—ã–µ / Display', items:[
    {name:'Fredoka', css:"'Fredoka', 'Montserrat', sans-serif", gf:"family=Fredoka:wght@400;700&display=swap"},
    {name:'Baloo 2', css:"'Baloo 2', cursive", gf:"family=Baloo+2:wght@400;700&display=swap"},
    {name:'Bangers (–ª–∞—Ç.)', css:"'Bangers', cursive", gf:"family=Bangers&display=swap"},
    {name:'Chewy (–ª–∞—Ç.)', css:"'Chewy', cursive", gf:"family=Chewy&display=swap"},
    {name:'Amatic SC (–ª–∞—Ç.)', css:"'Amatic SC', cursive", gf:"family=Amatic+SC:wght@400;700&display=swap"}
  ]},
  {group:'–û—Å–æ–±—ã–µ / –ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–µ', items:[
    {name:'Cinzel Decorative', css:"'Cinzel Decorative', serif", gf:"family=Cinzel+Decorative:wght@400;700&display=swap"},
    {name:'IM Fell English', css:"'IM Fell English', serif", gf:"family=IM+Fell+English:ital@0;1&display=swap"},
    {name:'UnifrakturCook (–ª–∞—Ç.)', css:"'UnifrakturCook', serif", gf:"family=UnifrakturCook:wght@700&display=swap"}
  ]},
  {group:'–í–æ—Å—Ç–æ—á–Ω—ã–µ (JP/KR/ZH)', items:[
    {name:'Noto Sans JP', css:"'Noto Sans JP','Hiragino Kaku Gothic Pro','Meiryo',sans-serif", gf:"family=Noto+Sans+JP:wght@400;700&display=swap"},
    {name:'Noto Serif JP', css:"'Noto Serif JP','Hiragino Mincho Pro',serif", gf:"family=Noto+Serif+JP:wght@400;700&display=swap"},
    {name:'Noto Sans KR', css:"'Noto Sans KR','Malgun Gothic',sans-serif", gf:"family=Noto+Sans+KR:wght@400;700&display=swap"},
    {name:'Noto Sans SC (ÁÆÄ‰Ωì‰∏≠Êñá)', css:"'Noto Sans SC','PingFang SC','Microsoft YaHei',sans-serif", gf:"family=Noto+Sans+SC:wght@400;700&display=swap"}
  ]},
  {group:'–°–∏—Å—Ç–µ–º–Ω—ã–µ (–±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏)', items:[
    {name:'System UI', css:"system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif", gf:""},
    {name:'Georgia (serif)', css:"Georgia, serif", gf:""},
    {name:'Arial (sans)', css:"Arial, Helvetica, sans-serif", gf:""},
    {name:'Times New Roman', css:"'Times New Roman', Times, serif", gf:""}
  ]}
];
const $font = $("fontPreset");
(function fillFonts(){
  FONTS.forEach(group=>{
    const og=document.createElement('optgroup'); og.label=group.group;
    group.items.forEach(f=>{
      const o=document.createElement('option'); o.textContent=f.name; o.value=f.css; o.dataset.gf=f.gf||"";
      og.appendChild(o);
    });
    $font.appendChild(og);
  });
  $font.selectedIndex=0;
})();
function loadFont(){
  const opt=$font.options[$font.selectedIndex];
  $("gfLink").href = opt.dataset.gf ? "https://fonts.googleapis.com/css2?"+opt.dataset.gf : "";
  updateIframeAndPreview();
}

/* ===== –°–≤–æ—Ç—á–∏ ===== */
function bindSwatch(boxId, inputId){
  const box=$(boxId), inp=$(inputId);
  box.style.background = inp.value;
  box.addEventListener('click', ()=> inp.showPicker ? inp.showPicker() : inp.click());
  inp.addEventListener('input', ()=>{ box.style.background=inp.value; updateIframeAndPreview(); });
}
['textColor','highlightColor','bgColor','borderColor'].forEach(id=>bindSwatch(id+'Box', id));
$("highlightOpacity").addEventListener('input', e=>{ $("hoVal").textContent = (+e.target.value).toFixed(2); updateIframeAndPreview(); });
$("bgOpacity").addEventListener('input', e=>{ $("boVal").textContent = (+e.target.value).toFixed(2); updateIframeAndPreview(); });

/* ===== –°–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ / JSON ===== */
function collectParamsFromUI(){
  const opt = $font.options[$font.selectedIndex];
  const noBorder = $("noBorder").checked;
  return {
    title: $("title").value.trim(),
    text: $("text").value, // —Å –∞–±–∑–∞—Ü–∞–º–∏
    fontFamily: opt ? opt.value : "system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif",
    fontSize: parseInt($("fontSize").value)||28,
    textColor: $("textColor").value,
    titleColor: $("highlightColor").value,
    highlightColor: $("highlightColor").value,
    highlightOpacity: parseFloat($("highlightOpacity").value)||0.3,
    bgColor: $("bgColor").value,
    bgOpacity: parseFloat($("bgOpacity").value)||0.75,
    border: noBorder ? "none" : "solid",
    borderColor: noBorder ? "" : $("borderColor").value,
    borderRadius: parseInt($("borderRadius").value)||18
  };
}
function makeJsonForSave(){
  const p = collectParamsFromUI();
  return { title: p.title, text: p.text };
}

/* ===== IFRAME SRC / PREVIEW ===== */
function buildIframeSrc(params){
  const usp = new URLSearchParams({
    id: LAST_ID || "",
    title: params.title || "",
    fontFamily: params.fontFamily || "",
    fontSize: params.fontSize || 28,
    textColor: params.textColor || "#fff8e1",
    titleColor: params.titleColor || params.highlightColor || "#ffd700",
    highlightColor: params.highlightColor || "#ffd700",
    highlightOpacity: params.highlightOpacity ?? 0.3,
    highlightStyle: "background",
    bgColor: params.bgColor || "#0b271f",
    bgOpacity: params.bgOpacity ?? 0.75,
    border: params.border || "none",
    borderColor: params.borderColor || params.highlightColor || "#ffd700",
    borderRadius: params.borderRadius ?? 18,
    v: Date.now()
  });
  return `${BASE_MAIN}?${usp.toString()}`;
}

function updateIframeAndPreview(){
  const p = collectParamsFromUI();
  const fw = $("fw").value, fh = $("fh").value;
  let src, iframeCode;

  if (LAST_ID) {
    src = buildIframeSrc(p);
    iframeCode = `<iframe src="${src}" width="${fw}" height="${fh}" style="border:none;border-radius:16px;overflow:hidden;" allow="microphone; autoplay" allowfullscreen></iframe>`;
  } else {
    const dataUrl = "data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(makeJsonForSave()));
    const usp = new URLSearchParams({
      data: dataUrl,
      title: p.title || "",
      fontFamily: p.fontFamily || "",
      fontSize: p.fontSize || 28,
      textColor: p.textColor || "#fff8e1",
      titleColor: p.titleColor || p.highlightColor || "#ffd700",
      highlightColor: p.highlightColor || "#ffd700",
      highlightOpacity: p.highlightOpacity ?? 0.3,
      highlightStyle: "background",
      bgColor: p.bgColor || "#0b271f",
      bgOpacity: p.bgOpacity ?? 0.75,
      border: p.border || "none",
      borderColor: p.borderColor || p.highlightColor || "#ffd700",
      borderRadius: p.borderRadius ?? 18,
      v: Date.now()
    });
    src = `${BASE_MAIN}?${usp.toString()}`;
    iframeCode = `<iframe src="${src}" width="${fw}" height="${fh}" style="border:none;border-radius:16px;overflow:hidden;" allow="microphone; autoplay" allowfullscreen></iframe>`;
  }

  $("preview").src = src;
  $("out").value = iframeCode;
}

/* ===== –ü—É–±–ª–∏–∫–∞—Ü–∏—è ===== */
async function publish(){
  try{
    setStatus("üîÆ –ü—É–±–ª–∏–∫—É—é‚Ä¶","warn");
    const jsonData = makeJsonForSave();
    const id = `${slug(jsonData.title)}-${stamp()}`;

    const res = await fetch(ENDPOINT, {
      method:"POST",
      headers:{ "Content-Type":"application/json", "X-Publish-Key": PUBLISH_KEY },
      body: JSON.stringify({ id, mode:"json", folder:"data", content: JSON.stringify(jsonData, null, 2) })
    });
    if(!res.ok) throw new Error(await res.text().catch(()=> res.statusText));

    LAST_ID = id; // —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –∑–¥–µ—Å—å
    localStorage.setItem('rt_last_id', LAST_ID);
    setStatus(`‚úÖ –ì–æ—Ç–æ–≤–æ! –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –∫–∞–∫: ${LAST_ID}`, "ok");
    updateIframeAndPreview();
  }catch(e){
    setStatus('‚ò† –û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: '+e.message, 'bad');
  }
}

/* ===== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ===== */
["title","text","fontSize","borderRadius","fw","fh","allowMic","allowAutoplay","allowFs","noBorder"].forEach(id=>{
  const el=$(id); el.addEventListener(el.type==="checkbox"?"change":"input", updateIframeAndPreview);
});
$font.addEventListener('change', loadFont);
$("publishBtn").addEventListener("click", publish);
$("copyBtn").addEventListener("click", ()=>{
  updateIframeAndPreview();
  navigator.clipboard.writeText($("out").value.trim()).then(()=>setStatus("üìù iframe —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω","ok"));
});
document.addEventListener("DOMContentLoaded", ()=>{ loadFont(); updateIframeAndPreview(); });
</script>
</body>
</html>
