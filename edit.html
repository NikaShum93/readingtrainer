<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Grimoire of Reading ‚Äî —Ä–µ–¥–∞–∫—Ç–æ—Ä</title>
<link id="gfLink" rel="stylesheet" href="">
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{--ink:#e9f2e9;--ink-d:#cfe2d2;--bg:#0f1b14;--panel:#0c2218e6;--acc:#6ee7b7;--acc2:#34d399}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
  header{text-align:center;padding:22px 12px 8px}
  h1{margin:0;font-size:clamp(22px,3.4vw,38px);font-family:"Cinzel Decorative",serif;color:#bfffe3;text-shadow:0 0 18px #1c6e52}
  .panel{max-width:1060px;margin:16px auto;background:var(--panel);border:1.5px solid #1d3c2b;border-radius:18px;padding:16px}
  label{display:block;margin:10px 0 6px;font-weight:800;color:#b2f2da}
  input,textarea,select{width:100%;background:#0a1c15;color:var(--ink);border:1.5px solid #164632;border-radius:12px;padding:10px 12px}
  textarea{min-height:110px}
  .row{display:flex;gap:12px;flex-wrap:wrap}.col{flex:1 1 260px}
  .toggle{display:inline-flex;gap:8px;align-items:center;background:#0b1f17;border:1px solid #1f4b37;border-radius:10px;padding:8px 10px}
  .btn{background:linear-gradient(90deg,#20c997 0,#10b981 100%);color:#083a2b;border:none;border-radius:12px;padding:10px 14px;font-weight:900;cursor:pointer}
  .status{margin-top:10px;padding:10px;border-radius:10px;border:1px solid #214d39;background:#0c2018;display:none}
  .ok{color:#b8ffd6}.bad{color:#ffbbbb}.warn{color:#ffe3a6}
  .out{margin-top:12px;border:1px dashed #1e4b37;border-radius:12px;background:#0a1e17}
  #out{width:100%;min-height:90px;border:none;background:transparent;color:var(--ink);padding:12px;font-family:ui-monospace,Consolas,monospace;white-space:pre}
  iframe{width:100%;height:420px;border:none;border-radius:12px;margin-top:10px}
  .hint{opacity:.8;font-size:.9em;margin-top:4px;color:#cfe2d2}
</style>
</head>
<body>
<header><h1>Grimoire of Reading ‚Äî —Ä–µ–¥–∞–∫—Ç–æ—Ä</h1></header>

<div class="panel">
  <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
  <input id="title" value="–í–æ–ª—à–µ–±–Ω–∞—è –ø–æ–ª—ã–Ω—å">

  <label>–¢–µ–∫—Å—Ç</label>
  <textarea id="text">–í —Ç–∏—à–∏ –º—à–∏—Å—Ç–æ–≥–æ –ª–µ—Å–∞ —à—É—Ä—à–∞—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–µ–≤–∏–¥–∏–º–æ–π –∫–Ω–∏–≥–∏. –° –∫–∞–∂–¥—ã–º –≤–¥–æ—Ö–æ–º –≤–æ–∑–¥—É—Ö –Ω–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞—Ä–æ–º–∞—Ç–æ–º –ø–æ–ª—ã–Ω–∏, –∞ –±—É–∫–≤—ã —Ç—è–Ω—É—Ç—Å—è –∫ —Å–≤–µ—Ç—É ‚Äî –∫–∞–∫ —Å–≤–µ—Ç–ª—è—á–∫–∏ –∫ –ª—É–Ω–µ.</textarea>

  <div class="row">
    <div class="col">
      <label>–®—Ä–∏—Ñ—Ç (–ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)</label>
      <select id="fontPreset"></select>
      <div class="hint">–°–ø–∏—Å–∫–∏: —á–∏—Ç–∞–±–µ–ª—å–Ω—ã–µ, —Ä—É–∫–æ–ø–∏—Å–Ω—ã–µ, –º—É–ª—å—Ç—è—à–Ω—ã–µ, –∫–∏—Ä–∏–ª–ª–∏—Ü–∞, –≤–æ—Å—Ç–æ—á–Ω—ã–µ, –∞—Ä–∞–±—Å–∫–∏–π –∏ –¥—Ä.</div>
    </div>
    <div class="col">
      <label>–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ (px)</label>
      <input type="number" id="fontSize" value="28" min="16" max="72">
    </div>
    <div class="col">
      <label>–¢–∏–ø –ø–æ–¥—Å–≤–µ—Ç–∫–∏</label>
      <select id="highlightStyle">
        <option value="background">–ü–æ–¥–ª–æ–∂–∫–∞</option>
        <option value="text">–¶–≤–µ—Ç –±—É–∫–≤</option>
      </select>
    </div>
  </div>

  <div class="row">
    <div class="col">
      <label>–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
      <input type="color" id="textColor" value="#E9F2E3">
    </div>
    <div class="col">
      <label>–¶–≤–µ—Ç –ø–æ–¥—Å–≤–µ—Ç–∫–∏</label>
      <input type="color" id="highlightColor" value="#34d399">
    </div>
    <div class="col">
      <label>–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫–∏ (0‚Äì1)</label>
      <input type="range" id="highlightOpacity" min="0" max="1" step="0.05" value="1">
    </div>
  </div>

  <div class="row">
    <div class="col">
      <label>–§–æ–Ω ‚Äî —Ü–≤–µ—Ç</label>
      <input type="color" id="bgColor" value="#0c1a14">
    </div>
    <div class="col">
      <label>–§–æ–Ω ‚Äî –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (0‚Äì1)</label>
      <input type="range" id="bgOpacity" min="0" max="1" step="0.05" value="0.25">
    </div>
    <div class="col">
      <label class="toggle"><input type="checkbox" id="noBorder"> –±–µ–∑ —Ä–∞–º–∫–∏</label>
    </div>
  </div>

  <div class="row">
    <div class="col">
      <label>–¶–≤–µ—Ç —Ä–∞–º–∫–∏</label>
      <input type="color" id="borderColor" value="#6ee7b7">
    </div>
    <div class="col">
      <label>–°–∫—Ä—É–≥–ª–µ–Ω–∏–µ —Ä–∞–º–∫–∏ (0‚Äì1000 px)</label>
      <input type="number" id="borderRadius" min="0" max="1000" value="18">
    </div>
    <div class="col">
      <label>–†–∞–∑–º–µ—Ä—ã –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è</label>
      <input type="number" id="fw" value="900" min="300" max="3000" style="margin-bottom:6px">
      <input type="number" id="fh" value="520" min="200" max="3000" style="margin-bottom:6px">
      <label class="toggle"><input type="checkbox" id="allowMic" checked> microphone</label>
      <label class="toggle"><input type="checkbox" id="allowAutoplay" checked> autoplay</label>
      <label class="toggle"><input type="checkbox" id="allowFs" checked> allowfullscreen</label>
      <label class="toggle"><input type="checkbox" id="cacheBust"> –æ–±—Ö–æ–¥ –∫–µ—à–∞</label>
    </div>
  </div>

  <div class="row" style="margin-top:12px">
    <button class="btn" id="publishBtn" type="button">üß™ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
    <button class="btn" id="copyBtn" type="button">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å iframe</button>
  </div>

  <div class="status" id="status"></div>

  <div class="out"><textarea id="out" readonly></textarea></div>
  <iframe id="preview" allow="microphone; autoplay"></iframe>
</div>

<script>
// ===== –ø—É–±–ª–∏–∫–∞—Ü–∏—è (–≤—à–∏—Ç–æ) =====
const ENDPOINT = "https://server-kjnn.onrender.com/publish";
const PUBLISH_KEY = "nika_read_pub_2025"; // ‚ö†Ô∏è –ª—é–±–æ–π —Å —Ñ–∞–π–ª–æ–º —Å–º–æ–∂–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ —Ç–≤–æ–π —Å–µ—Ä–≤–µ—Ä
const BASE_MAIN = "https://nikashum93.github.io/readingtrainer/main.html";

const $ = id => document.getElementById(id);
const statusBox = $("status");
function setStatus(html, cls=''){ statusBox.style.display='block'; statusBox.className='status '+cls; statusBox.innerHTML=html; }

function slug(s){return (s||'untitled').toString().toLowerCase().normalize('NFKD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'').slice(0,40)||'note'}
function stamp(){const d=new Date(),p=n=>String(n).padStart(2,'0');return`${d.getFullYear()}${p(d.getMonth()+1)}${p(d.getDate())}-${p(d.getHours())}${p(d.getMinutes())}${p(d.getSeconds())}`}

// ======= –®–†–ò–§–¢–´ (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ + –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ Google Fonts) =======
const FONTS = [
  {group:'–ß–∏—Ç–∞–±–µ–ª—å–Ω—ã–µ (UI, –∫–∏—Ä–∏–ª–ª–∏—Ü–∞)', items:[
    {name:'Inter', css:"'Inter', system-ui, Arial, sans-serif", gf:"family=Inter:wght@400;700&display=swap"},
    {name:'Roboto', css:"'Roboto', Arial, sans-serif", gf:"family=Roboto:wght@400;700&display=swap"},
    {name:'Montserrat', css:"'Montserrat', Arial, sans-serif", gf:"family=Montserrat:wght@400;700&display=swap"},
    {name:'Nunito', css:"'Nunito', Arial, sans-serif", gf:"family=Nunito:wght@400;700&display=swap"},
    {name:'Rubik', css:"'Rubik', Arial, sans-serif", gf:"family=Rubik:wght@400;700&display=swap"},
    {name:'PT Sans', css:"'PT Sans', Arial, sans-serif", gf:"family=PT+Sans:wght@400;700&display=swap"},
    {name:'Source Sans 3', css:"'Source Sans 3', Arial, sans-serif", gf:"family=Source+Sans+3:wght@400;700&display=swap"},
    {name:'Ubuntu', css:"'Ubuntu', Arial, sans-serif", gf:"family=Ubuntu:wght@400;700&display=swap"},
    {name:'Fira Sans', css:"'Fira Sans', Arial, sans-serif", gf:"family=Fira+Sans:wght@400;700&display=swap"}
  ]},
  {group:'–°–µ—Ä–∏—Ñ (–∫–Ω–∏–≥–∏, –∫–∏—Ä–∏–ª–ª–∏—Ü–∞)', items:[
    {name:'Merriweather', css:"'Merriweather', Georgia, serif", gf:"family=Merriweather:wght@400;700&display=swap"},
    {name:'PT Serif', css:"'PT Serif', Georgia, serif", gf:"family=PT+Serif:wght@400;700&display=swap"},
    {name:'Playfair Display', css:"'Playfair Display', Georgia, serif", gf:"family=Playfair+Display:wght@400;700&display=swap"},
    {name:'Literata', css:"'Literata', Georgia, serif", gf:"family=Literata:wght@400;700&display=swap"}
  ]},
  {group:'–†—É–∫–æ–ø–∏—Å–Ω—ã–µ (–µ—Å—Ç—å –∫–∏—Ä–∏–ª–ª–∏—Ü–∞)', items:[
    {name:'Caveat', css:"'Caveat', cursive", gf:"family=Caveat:wght@400;700&display=swap"},
    {name:'Marck Script', css:"'Marck Script', cursive", gf:"family=Marck+Script&display=swap"},
    {name:'Neucha', css:"'Neucha', cursive", gf:"family=Neucha&display=swap"},
    {name:'Pacifico', css:"'Pacifico', cursive", gf:"family=Pacifico&display=swap"},
    {name:'Lobster', css:"'Lobster', cursive", gf:"family=Lobster&display=swap"},
    {name:'Comfortaa', css:"'Comfortaa', cursive", gf:"family=Comfortaa:wght@400;700&display=swap"}
  ]},
  {group:'–ú—É–ª—å—Ç—è—à–Ω—ã–µ / Display', items:[
    {name:'Fredoka', css:"'Fredoka', 'Montserrat', sans-serif", gf:"family=Fredoka:wght@400;700&display=swap"},
    {name:'Baloo 2', css:"'Baloo 2', cursive", gf:"family=Baloo+2:wght@400;700&display=swap"},
    {name:'Bangers (–ª–∞—Ç–∏–Ω–∏—Ü–∞)', css:"'Bangers', cursive", gf:"family=Bangers&display=swap"},
    {name:'Chewy (–ª–∞—Ç–∏–Ω–∏—Ü–∞)', css:"'Chewy', cursive", gf:"family=Chewy&display=swap"},
    {name:'Amatic SC (–ª–∞—Ç–∏–Ω–∏—Ü–∞)', css:"'Amatic SC', cursive", gf:"family=Amatic+SC:wght@400;700&display=swap"}
  ]},
  {group:'–û—Å–æ–±—ã–µ / –ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–µ', items:[
    {name:'Cinzel Decorative', css:"'Cinzel Decorative', serif", gf:"family=Cinzel+Decorative:wght@400;700&display=swap"},
    {name:'IM Fell English', css:"'IM Fell English', serif", gf:"family=IM+Fell+English:ital@0;1&display=swap"},
    {name:'UnifrakturCook (–ª–∞—Ç–∏–Ω–∏—Ü–∞)', css:"'UnifrakturCook', serif", gf:"family=UnifrakturCook:wght@700&display=swap"}
  ]},
  {group:'–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å / –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å', items:[
    {name:'Atkinson Hyperlegible', css:"'Atkinson Hyperlegible', Arial, sans-serif", gf:"family=Atkinson+Hyperlegible:wght@400;700&display=swap"},
    {name:'Lexend', css:"'Lexend', Arial, sans-serif", gf:"family=Lexend:wght@400;700&display=swap"}
  ]},
  {group:'–í–æ—Å—Ç–æ—á–Ω—ã–µ (JP / KR / ZH)', items:[
    {name:'Noto Sans JP', css:"'Noto Sans JP', 'Hiragino Kaku Gothic Pro', 'Meiryo', sans-serif", gf:"family=Noto+Sans+JP:wght@400;700&display=swap"},
    {name:'Noto Serif JP', css:"'Noto Serif JP', 'Hiragino Mincho Pro', serif", gf:"family=Noto+Serif+JP:wght@400;700&display=swap"},
    {name:'Noto Sans KR', css:"'Noto Sans KR', 'Malgun Gothic', sans-serif", gf:"family=Noto+Sans+KR:wght@400;700&display=swap"},
    {name:'Noto Sans SC (ÁÆÄ‰Ωì‰∏≠Êñá)', css:"'Noto Sans SC', 'PingFang SC', 'Microsoft YaHei', sans-serif", gf:"family=Noto+Sans+SC:wght@400;700&display=swap"}
  ]},
  {group:'–ü–∏—Å—å–º–µ–Ω–Ω–æ—Å—Ç–∏ –º–∏—Ä–∞', items:[
    {name:'Noto Naskh Arabic', css:"'Noto Naskh Arabic', 'Amiri', serif", gf:"family=Noto+Naskh+Arabic:wght@400;700&display=swap"},
    {name:'Amiri (Arabic)', css:"'Amiri', serif", gf:"family=Amiri:wght@400;700&display=swap"},
    {name:'Noto Sans Hebrew', css:"'Noto Sans Hebrew', 'Rubik', sans-serif", gf:"family=Noto+Sans+Hebrew:wght@400;700&display=swap"},
    {name:'Noto Sans Devanagari', css:"'Noto Sans Devanagari', 'Hind', sans-serif", gf:"family=Noto+Sans+Devanagari:wght@400;700&display=swap"},
    {name:'Noto Sans Georgian', css:"'Noto Sans Georgian', sans-serif", gf:"family=Noto+Sans+Georgian:wght@400;700&display=swap"}
  ]},
  {group:'–°–∏—Å—Ç–µ–º–Ω—ã–µ (–±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏)', items:[
    {name:'System UI', css:"system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif", gf:""},
    {name:'Georgia (serif)', css:"Georgia, serif", gf:""},
    {name:'Arial (sans)', css:"Arial, Helvetica, sans-serif", gf:""},
    {name:'Times New Roman', css:"'Times New Roman', Times, serif", gf:""}
  ]}
];

const fontSelect = $("fontPreset");
(function fillFonts(){
  FONTS.forEach(group=>{
    const og = document.createElement('optgroup'); og.label = group.group;
    group.items.forEach(f=>{
      const opt = document.createElement('option');
      opt.textContent = f.name;
      opt.value = f.css;
      opt.dataset.gf = f.gf || "";
      og.appendChild(opt);
    });
    fontSelect.appendChild(og);
  });
  // –¥–µ—Ñ–æ–ª—Ç ‚Äî Inter (–ø–µ—Ä–≤–∞—è –æ–ø—Ü–∏—è)
  fontSelect.selectedIndex = 0;
})();

function applyFontPreset(){
  const opt = fontSelect.options[fontSelect.selectedIndex];
  const css = opt.value;
  const gf = opt.dataset.gf;
  $("gfLink").href = gf ? "https://fonts.googleapis.com/css2?"+gf : "";
  // –ø—Ä–∏–º–µ–Ω—è–µ–º –∫ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä—É —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä fontFamily (–≤ main –æ–Ω —á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ JSON)
  renderPreviewLocal();
}

// ===== –¥–∞–Ω–Ω—ã–µ + –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä =====
function buildData(){
  const border = $("noBorder").checked ? "none" : "solid";
  const borderColor = $("noBorder").checked ? "" : $("borderColor").value;
  const selected = fontSelect.options[fontSelect.selectedIndex];
  return {
    title: $("title").value,
    text: $("text").value,
    fontFamily: selected ? selected.value : "system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif",
    fontSize: parseInt($("fontSize").value)||28,
    textColor: $("textColor").value,
    titleColor: $("highlightColor").value,
    highlightColor: $("highlightColor").value,
    highlightOpacity: parseFloat($("highlightOpacity").value)||1,
    highlightStyle: $("highlightStyle").value,
    bgColor: $("bgColor").value,
    bgOpacity: parseFloat($("bgOpacity").value)||0,
    border, borderColor,
    borderRadius: parseInt($("borderRadius").value)||0
  };
}

function renderPreviewLocal(){
  const data = buildData();
  const blob = new Blob([JSON.stringify(data)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const src = `${BASE_MAIN}?data=${encodeURIComponent(url)}`;
  $("preview").src = src;

  const allow = [
    $("allowMic").checked ? "microphone" : "",
    $("allowAutoplay").checked ? "autoplay" : ""
  ].filter(Boolean).join("; ");
  const allowAttr = allow ? ` allow="${allow}"` : "";
  const fsAttr = $("allowFs").checked ? " allowfullscreen" : "";
  $("out").value = `<iframe src="${src}" width="${$("fw").value}" height="${$("fh").value}" style="border:none;border-radius:16px;overflow:hidden;"${allowAttr}${fsAttr}></iframe>`;
  setStatus("ü™Ñ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≥–æ—Ç–æ–≤.", "ok");
}

["title","text","fontSize","textColor","highlightColor","highlightOpacity","highlightStyle","bgColor","bgOpacity","borderColor","borderRadius","fw","fh","allowMic","allowAutoplay","allowFs","noBorder"].forEach(id=>{
  const el=$(id); el.addEventListener(el.type==="checkbox"?"change":"input", renderPreviewLocal);
});
fontSelect.addEventListener('change', applyFontPreset);
document.addEventListener("DOMContentLoaded", ()=>{ applyFontPreset(); renderPreviewLocal(); });

// ===== –ø—É–±–ª–∏–∫–∞—Ü–∏—è =====
async function publish(){
  try{
    setStatus("üîÆ –ü—É–±–ª–∏–∫—É—é‚Ä¶","warn");
    const data = buildData();
    const id = `${slug(data.title)}-${stamp()}`;
    const res = await fetch(ENDPOINT, {
      method:"POST",
      headers:{ "Content-Type":"application/json", "X-Publish-Key": PUBLISH_KEY },
      body: JSON.stringify({ id, mode:"json", folder:"data", content: JSON.stringify(data, null, 2) })
    });
    if(!res.ok){ const t=await res.text().catch(()=> ""); throw new Error(res.status+" "+res.statusText+(t?": "+t:"")); }

    // –∫–æ—Ä–æ—Ç–∫–∏–π iframe –ø–æ id
    const src = `${BASE_MAIN}?id=${encodeURIComponent(id)}`;
    $("preview").src = src;
    const allow = [
      $("allowMic").checked ? "microphone" : "",
      $("allowAutoplay").checked ? "autoplay" : ""
    ].filter(Boolean).join("; ");
    const allowAttr = allow ? ` allow="${allow}"` : "";
    const fsAttr = $("allowFs").checked ? " allowfullscreen" : "";
    $("out").value = `<iframe src="${src}" width="${$("fw").value}" height="${$("fh").value}" style="border:none;border-radius:16px;overflow:hidden;"${allowAttr}${fsAttr}></iframe>`;
    setStatus("‚úÖ –ì–æ—Ç–æ–≤–æ! –ó–∞–¥–∞–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ.", "ok");
  }catch(e){
    setStatus("‚ò† –û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: "+e.message, "bad");
  }
}
$("publishBtn").addEventListener("click", publish);
$("copyBtn").addEventListener("click", async ()=>{
  try{ await navigator.clipboard.writeText($("out").value.trim()); setStatus("üìù iframe —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω", "ok"); }
  catch{ const ta=$("out"); ta.focus(); ta.select(); document.execCommand("copy"); setStatus("üìù iframe —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω (fallback)", "ok"); }
});
</script>
</body>
</html>
