<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Grimoire of Reading ‚Äî —Ä–µ–¥–∞–∫—Ç–æ—Ä</title>
<link id="gfLink" rel="stylesheet" href="">
<style>
  :root{ --bg:#0e1a15; --card:#11251e; --ink:#e9f2e9; --accent:#34d399; }
  *{box-sizing:border-box} html,body{margin:0;height:100%}
  body{background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
  header{padding:24px 16px 8px;text-align:center}
  h1{margin:0;font-size:clamp(22px,3.4vw,38px);color:#bfffe3;text-shadow:0 0 18px #1c6e52}
  .wrap{max-width:1160px;margin:0 auto;padding:0 16px 28px;display:grid;gap:16px}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  @media (max-width:980px){ .grid2{grid-template-columns:1fr} }
  .card{background:var(--card);border-radius:12px;padding:16px 14px}
  .card h2{margin:0 0 10px;font-size:18px;color:#b2f2da}
  .row{display:grid;grid-template-columns:220px 1fr;gap:10px;align-items:center;margin:10px 0}
  @media (max-width:720px){ .row{grid-template-columns:1fr} }
  label{font-weight:700}
  input,textarea,select{width:100%;background:#0a1c15;color:var(--ink);border:1.5px solid #164632;border-radius:10px;padding:10px 12px}
  textarea{min-height:120px;resize:vertical}
  .sw{display:flex;align-items:center;gap:10px}
  .swatch{width:34px;height:34px;border-radius:8px;border:2px solid #2a6b4f;cursor:pointer;box-shadow:0 2px 8px #052019aa}
  input[type=color].picker{position:absolute;opacity:0;width:0;height:0}
  .btn{background:linear-gradient(90deg,#20c997 0,#10b981 100%);color:#083a2b;border:none;border-radius:10px;padding:10px 14px;font-weight:900;cursor:pointer}
  .status{padding:10px;border-radius:10px;background:#0c2018;border:1px solid #214d39;display:none}
  .ok{color:#b8ffd6}.bad{color:#ffbbbb}.warn{color:#ffe3a6}
  .code{border-radius:10px;background:#0a1e17}
  #out{width:100%;min-height:90px;border:none;background:transparent;color:var(--ink);padding:12px;font-family:ui-monospace,Consolas,monospace;white-space:pre}
  iframe{width:100%;height:440px;border:none;border-radius:12px}
</style>
</head>
<body>
<header><h1>Grimoire of Reading ‚Äî —Ä–µ–¥–∞–∫—Ç–æ—Ä</h1></header>

<div class="wrap">

  <section class="card">
    <h2>–¢–µ–∫—Å—Ç</h2>
    <div class="row"><label>–ó–∞–≥–æ–ª–æ–≤–æ–∫</label><input id="titleInput" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫"/></div>
    <div class="row"><label>–û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç</label><textarea id="textInput" placeholder="–ê–±–∑–∞—Ü—ã —Ä–∞–∑–¥–µ–ª—è–π –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π"></textarea></div>
  </section>

  <div class="grid2">
    <section class="card">
      <h2>–®—Ä–∏—Ñ—Ç –∏ —Ü–≤–µ—Ç</h2>
      <div class="row"><label>–ì–∞—Ä–Ω–∏—Ç—É—Ä–∞</label><select id="fontSelect"></select></div>
      <div class="row"><label>–†–∞–∑–º–µ—Ä (px)</label><input type="number" id="fontSize" value="28" min="16" max="72"></div>
      <div class="row">
        <label>–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
        <div class="sw"><div id="textColorBox" class="swatch"></div><input id="textColor" class="picker" type="color" value="#fff8e1"></div>
      </div>
      <div class="row">
        <label>–¶–≤–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞</label>
        <div class="sw"><div id="titleColorBox" class="swatch"></div><input id="titleColor" class="picker" type="color" value="#ffd700"></div>
      </div>
    </section>

    <section class="card">
      <h2>–ü–æ–¥—Å–≤–µ—Ç–∫–∞</h2>
      <div class="row">
        <label>–¶–≤–µ—Ç –ø–æ–¥—Å–≤–µ—Ç–∫–∏</label>
        <div class="sw"><div id="highlightColorBox" class="swatch"></div><input id="highlightColor" class="picker" type="color" value="#ffd700"></div>
      </div>
      <div class="row">
        <label>–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫–∏</label>
        <input id="highlightOpacity" type="range" min="0" max="1" step="0.05" value="0.35">
      </div>
      <div class="row">
        <label>–¢–∏–ø –ø–æ–¥—Å–≤–µ—Ç–∫–∏</label>
        <select id="highlightStyle">
          <option value="background">–ü–æ–¥–ª–æ–∂–∫–∞</option>
          <option value="text">–¶–≤–µ—Ç –±—É–∫–≤</option>
        </select>
      </div>
    </section>
  </div>

  <div class="grid2">
    <section class="card">
      <h2>–§–æ–Ω –∏ —Ä–∞–º–∫–∞</h2>
      <div class="row">
        <label>–§–æ–Ω ‚Äî —Ü–≤–µ—Ç</label>
        <div class="sw"><div id="bgColorBox" class="swatch"></div><input id="bgColor" class="picker" type="color" value="#0b271f"></div>
      </div>
      <div class="row"><label>–§–æ–Ω ‚Äî –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å</label><input id="bgOpacity" type="range" min="0" max="1" step="0.05" value="0.25"></div>
      <div class="row">
        <label>–¶–≤–µ—Ç —Ä–∞–º–∫–∏</label>
        <div class="sw"><div id="borderColorBox" class="swatch"></div><input id="borderColor" class="picker" type="color" value="#34d399"></div>
      </div>
      <div class="row"><label>–°–∫—Ä—É–≥–ª–µ–Ω–∏–µ —Ä–∞–º–∫–∏ (0‚Äì1000)</label><input id="borderRadius" type="number" min="0" max="1000" value="18"></div>
      <div class="row"><label>–û–ø—Ü–∏–∏</label><label><input type="checkbox" id="noBorder"> –±–µ–∑ —Ä–∞–º–∫–∏</label></div>
    </section>

    <section class="card">
      <h2>–í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ</h2>
      <div class="row"><label>–®–∏—Ä–∏–Ω–∞ iframe</label><input id="fw" type="number" value="900" min="300" max="3000"></div>
      <div class="row"><label>–í—ã—Å–æ—Ç–∞ iframe</label><input id="fh" type="number" value="520" min="200" max="3000"></div>
      <div class="row">
        <label>–†–∞–∑—Ä–µ—à–µ–Ω–∏—è</label>
        <div>
          <label><input type="checkbox" id="allowMic" checked> microphone</label>
          <label style="margin-left:10px"><input type="checkbox" id="allowAutoplay" checked> autoplay</label>
          <label style="margin-left:10px"><input type="checkbox" id="allowFs" checked> allowfullscreen</label>
        </div>
      </div>
      <div class="row">
        <button class="btn" id="publishBtn" type="button">üß™ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å JSON</button>
        <button class="btn" id="genBtn" type="button">üìã –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å IFRAME</button>
      </div>
      <div class="status" id="status"></div>
    </section>
  </div>

  <section class="card">
    <h2>–ö–æ–¥ –∏ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h2>
    <div class="code"><textarea id="out" readonly></textarea></div>
    <iframe id="preview" allow="microphone; autoplay"></iframe>
  </section>

</div>

<script>
/* ====== –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ ====== */
const ENDPOINT    = "https://server-kjnn.onrender.com/publish";
const PUBLISH_KEY = "nika_read_pub_2025";     // —Ç–≤–æ–π —Å–µ–∫—Ä–µ—Ç
const BASE_MAIN   = "https://nikashum93.github.io/readingtrainer/main.html";

/* ====== –£—Ç–∏–ª–∏—Ç—ã ====== */
const $ = id => document.getElementById(id);
function setStatus(html, cls=''){ const b=$("status"); b.style.display='block'; b.className='status '+cls; b.innerHTML=html; }
function slug(s){return (s||'untitled').toString().toLowerCase().normalize('NFKD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'').slice(0,48)||'note'}
function stamp(){const d=new Date(),p=n=>String(n).padStart(2,'0');return`${d.getFullYear()}${p(d.getMonth()+1)}${p(d.getDate())}-${p(d.getHours())}${p(d.getMinutes())}${p(d.getSeconds())}`}

/* ====== –ë–æ–ª—å—à–æ–π —Å–ø–∏—Å–æ–∫ —à—Ä–∏—Ñ—Ç–æ–≤ ====== */
const FONTS = [
  {group:'–ß–∏—Ç–∞–±–µ–ª—å–Ω—ã–µ (UI, –∫–∏—Ä–∏–ª–ª–∏—Ü–∞)', items:[
    {name:'Inter', css:"'Inter', system-ui, Arial, sans-serif", gf:"family=Inter:wght@400;700&display=swap"},
    {name:'Roboto', css:"'Roboto', Arial, sans-serif", gf:"family=Roboto:wght@400;700&display=swap"},
    {name:'Montserrat', css:"'Montserrat', Arial, sans-serif", gf:"family=Montserrat:wght@400;700&display=swap"},
    {name:'Nunito', css:"'Nunito', Arial, sans-serif", gf:"family=Nunito:wght@400;700&display=swap"},
    {name:'Rubik', css:"'Rubik', Arial, sans-serif", gf:"family=Rubik:wght@400;700&display=swap"},
    {name:'PT Sans', css:"'PT Sans', Arial, sans-serif", gf:"family=PT+Sans:wght@400;700&display=swap"},
    {name:'Source Sans 3', css:"'Source Sans 3', Arial, sans-serif", gf:"family=Source+Sans+3:wght@400;700&display=swap"},
    {name:'Ubuntu', css:"'Ubuntu', Arial, sans-serif", gf:"family=Ubuntu:wght@400;700&display=swap"},
    {name:'Fira Sans', css:"'Fira Sans', Arial, sans-serif", gf:"family=Fira+Sans:wght@400;700&display=swap"}
  ]},
  {group:'–°–µ—Ä–∏—Ñ (–∫–Ω–∏–≥–∏, –∫–∏—Ä–∏–ª–ª–∏—Ü–∞)', items:[
    {name:'Merriweather', css:"'Merriweather', Georgia, serif", gf:"family=Merriweather:wght@400;700&display=swap"},
    {name:'PT Serif', css:"'PT Serif', Georgia, serif", gf:"family=PT+Serif:wght@400;700&display=swap"},
    {name:'Playfair Display', css:"'Playfair Display', Georgia, serif", gf:"family=Playfair+Display:wght@400;700&display=swap"},
    {name:'Literata', css:"'Literata', Georgia, serif", gf:"family=Literata:wght@400;700&display=swap"}
  ]},
  {group:'–†—É–∫–æ–ø–∏—Å–Ω—ã–µ (–µ—Å—Ç—å –∫–∏—Ä–∏–ª–ª–∏—Ü–∞)', items:[
    {name:'Caveat', css:"'Caveat', cursive", gf:"family=Caveat:wght@400;700&display=swap"},
    {name:'Marck Script', css:"'Marck Script', cursive", gf:"family=Marck+Script&display=swap"},
    {name:'Neucha', css:"'Neucha', cursive", gf:"family=Neucha&display=swap"},
    {name:'Pacifico', css:"'Pacifico', cursive", gf:"family=Pacifico&display=swap"},
    {name:'Lobster', css:"'Lobster', cursive", gf:"family=Lobster&display=swap"},
    {name:'Comfortaa', css:"'Comfortaa', cursive", gf:"family=Comfortaa:wght@400;700&display=swap"}
  ]},
  {group:'–ú—É–ª—å—Ç—è—à–Ω—ã–µ / Display', items:[
    {name:'Fredoka', css:"'Fredoka', 'Montserrat', sans-serif", gf:"family=Fredoka:wght@400;700&display=swap"},
    {name:'Baloo 2', css:"'Baloo 2', cursive", gf:"family=Baloo+2:wght@400;700&display=swap"},
    {name:'Bangers (–ª–∞—Ç.)', css:"'Bangers', cursive", gf:"family=Bangers&display=swap"},
    {name:'Chewy (–ª–∞—Ç.)', css:"'Chewy', cursive", gf:"family=Chewy&display=swap"},
    {name:'Amatic SC (–ª–∞—Ç.)', css:"'Amatic SC', cursive", gf:"family=Amatic+SC:wght@400;700&display=swap"}
  ]},
  {group:'–û—Å–æ–±—ã–µ / –ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–µ', items:[
    {name:'Cinzel Decorative', css:"'Cinzel Decorative', serif", gf:"family=Cinzel+Decorative:wght@400;700&display=swap"},
    {name:'IM Fell English', css:"'IM Fell English', serif", gf:"family=IM+Fell+English:ital@0;1&display=swap"},
    {name:'UnifrakturCook (–ª–∞—Ç.)', css:"'UnifrakturCook', serif", gf:"family=UnifrakturCook:wght@700&display=swap"}
  ]},
  {group:'–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å / –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å', items:[
    {name:'Atkinson Hyperlegible', css:"'Atkinson Hyperlegible', Arial, sans-serif", gf:"family=Atkinson+Hyperlegible:wght@400;700&display=swap"},
    {name:'Lexend', css:"'Lexend', Arial, sans-serif", gf:"family=Lexend:wght@400;700&display=swap"}
  ]},
  {group:'–í–æ—Å—Ç–æ—á–Ω—ã–µ (JP/KR/ZH)', items:[
    {name:'Noto Sans JP', css:"'Noto Sans JP','Hiragino Kaku Gothic Pro','Meiryo',sans-serif", gf:"family=Noto+Sans+JP:wght@400;700&display=swap"},
    {name:'Noto Serif JP', css:"'Noto Serif JP','Hiragino Mincho Pro',serif", gf:"family=Noto+Serif+JP:wght@400;700&display=swap"},
    {name:'Noto Sans KR', css:"'Noto Sans KR','Malgun Gothic',sans-serif", gf:"family=Noto+Sans+KR:wght@400;700&display=swap"},
    {name:'Noto Sans SC (ÁÆÄ‰Ωì‰∏≠Êñá)', css:"'Noto Sans SC','PingFang SC','Microsoft YaHei',sans-serif", gf:"family=Noto+Sans+SC:wght@400;700&display=swap"}
  ]},
  {group:'–ü–∏—Å—å–º–µ–Ω–Ω–æ—Å—Ç–∏ –º–∏—Ä–∞', items:[
    {name:'Noto Naskh Arabic', css:"'Noto Naskh Arabic','Amiri',serif", gf:"family=Noto+Naskh+Arabic:wght@400;700&display=swap"},
    {name:'Amiri (Arabic)', css:"'Amiri', serif", gf:"family=Amiri:wght@400;700&display=swap"},
    {name:'Noto Sans Hebrew', css:"'Noto Sans Hebrew','Rubik',sans-serif", gf:"family=Noto+Sans+Hebrew:wght@400;700&display=swap"},
    {name:'Noto Sans Devanagari', css:"'Noto Sans Devanagari','Hind',sans-serif", gf:"family=Noto+Sans+Devanagari:wght@400;700&display=swap"},
    {name:'Noto Sans Georgian', css:"'Noto Sans Georgian',sans-serif", gf:"family=Noto+Sans+Georgian:wght@400;700&display=swap"}
  ]},
  {group:'–°–∏—Å—Ç–µ–º–Ω—ã–µ (–±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏)', items:[
    {name:'System UI', css:"system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif", gf:""},
    {name:'Georgia (serif)', css:"Georgia, serif", gf:""},
    {name:'Arial (sans)', css:"Arial, Helvetica, sans-serif", gf:""},
    {name:'Times New Roman', css:"'Times New Roman', Times, serif", gf:""}
  ]}
];
(function fillFonts(){
  const sel = $("fontSelect");
  FONTS.forEach(g=>{
    const og=document.createElement('optgroup'); og.label=g.group;
    g.items.forEach(f=>{ const o=document.createElement('option'); o.textContent=f.name; o.value=f.css; o.dataset.gf=f.gf||""; og.appendChild(o); });
    sel.appendChild(og);
  });
  sel.selectedIndex=0;
})();
$("fontSelect").addEventListener('change', ()=>{
  const opt=$("fontSelect").options[$("fontSelect").selectedIndex];
  $("gfLink").href = opt.dataset.gf ? "https://fonts.googleapis.com/css2?"+opt.dataset.gf : "";
});

/* ====== –°–≤–æ—Ç—á–∏ ====== */
function bindSwatch(boxId, inputId){
  const box=$(boxId), inp=$(inputId);
  box.style.background = inp.value;
  box.addEventListener('click', ()=> inp.showPicker ? inp.showPicker() : inp.click());
  inp.addEventListener('input', ()=> box.style.background=inp.value);
}
['textColor','titleColor','highlightColor','bgColor','borderColor']
  .forEach(id=>bindSwatch(id+'Box', id));

/* ====== IFRAME-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è ====== */
function currentParams(){
  return {
    title: $("titleInput").value.trim(),
    fontFamily: $("fontSelect").value,
    fontSize: $("fontSize").value,
    textColor: $("textColor").value,
    titleColor: $("titleColor").value,
    highlightColor: $("highlightColor").value,
    highlightOpacity: $("highlightOpacity").value,
    highlightStyle: $("highlightStyle").value,
    bgColor: $("bgColor").value,
    bgOpacity: $("bgOpacity").value,
    border: $("noBorder").checked ? "none" : "solid",
    borderColor: $("borderColor").value,
    borderRadius: $("borderRadius").value
  };
}
function buildIframe(id){
  const v = Date.now();
  const u = new URL(BASE_MAIN);
  u.searchParams.set("v", v);
  u.searchParams.set("id", id);

  const p = currentParams();
  Object.entries(p).forEach(([k,v])=> u.searchParams.set(k, v));

  const allow = [
    $("allowMic").checked ? "microphone" : "",
    $("allowAutoplay").checked ? "autoplay" : ""
  ].filter(Boolean).join("; ");

  const iframe = `<iframe src="${u.toString()}"
width="${$("fw").value}" height="${$("fh").value}"
style="border:none;border-radius:16px;overflow:hidden;"
${$("allowFs").checked ? "allowfullscreen":""} ${allow?`allow="${allow}"`:""}></iframe>`;

  $("out").value = iframe;
  $("preview").src = u.toString();
  setStatus("ü™Ñ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ–±–Ω–æ–≤–ª—ë–Ω.", "ok");
}

/* ====== –ü—É–±–ª–∏–∫–∞—Ü–∏—è JSON {title,text} ====== */
async function publishJSON(){
  try{
    setStatus("üîÆ –ü—É–±–ª–∏–∫—É—é‚Ä¶", "warn");
    const id = `${slug($("titleInput").value||'note')}-${stamp()}`;
    const content = {
      title: $("titleInput").value.trim(),
      text:  $("textInput").value.replace(/\r\n/g,'\n')  // –∞–±–∑–∞—Ü—ã –∫–∞–∫ –µ—Å—Ç—å
    };
    const res = await fetch(ENDPOINT,{
      method:"POST",
      headers:{ "Content-Type":"application/json", "X-Publish-Key": PUBLISH_KEY },
      body: JSON.stringify({ id, mode:"json", folder:"data", content: JSON.stringify(content, null, 2) })
    });
    if(!res.ok){ const t=await res.text().catch(()=> ""); throw new Error(res.status+" "+res.statusText+(t?": "+t:"")); }
    buildIframe(id);
    setStatus("‚úÖ –ì–æ—Ç–æ–≤–æ! –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ –∏ IFRAME —Å–æ–±—Ä–∞–Ω.", "ok");
  }catch(e){ setStatus("‚ò† –û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: "+e.message, "bad"); }
}

/* ====== —Å–æ–±—ã—Ç–∏—è ====== */
$("publishBtn").addEventListener("click", publishJSON);
$("genBtn").addEventListener("click", ()=>{
  const tmpId = `${slug($("titleInput").value||'note')}-${stamp()}`; // —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –≥–ª—è–Ω—É—Ç—å –ø—Ä–µ–≤—å—é –±–µ–∑ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
  buildIframe(tmpId);
});

/* —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ –ø—Ä–µ–≤—å—é */
buildIframe(`${slug('draft')}-${stamp()}`);
</script>
</body>
</html>
