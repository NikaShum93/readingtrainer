<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Grimoire of Reading ‚Äî —Ä–µ–¥–∞–∫—Ç–æ—Ä</title>
<link id="gfLink" rel="stylesheet" href="">
<style>
  :root{ --bg:#0e1a15; --card:#11251e; --card2:#0c2019; --ink:#e9f2e9; --accent:#34d399; }
  *{box-sizing:border-box} html,body{margin:0;height:100%}
  body{background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
  header{padding:24px 16px 8px;text-align:center}
  h1{margin:0;font-size:clamp(22px,3.4vw,38px);color:#bfffe3;text-shadow:0 0 18px #1c6e52}
  .wrap{max-width:1160px;margin:0 auto;padding:0 16px 28px;display:grid;gap:16px}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  @media (max-width:980px){ .grid2{grid-template-columns:1fr} }
  .card{background:var(--card);border-radius:12px;padding:16px 14px}
  .card h2{margin:0 0 10px;font-size:18px;color:#b2f2da}
  .row{display:grid;grid-template-columns:220px 1fr;gap:10px;align-items:center;margin:10px 0}
  @media (max-width:720px){ .row{grid-template-columns:1fr} }
  label.lbl{color:#b2f2da;font-weight:800}
  input,textarea,select{width:100%;background:var(--card2);color:var(--ink);border:1.5px solid #164632;border-radius:10px;padding:10px 12px}
  textarea{min-height:110px;resize:vertical}
  .sw{display:flex;align-items:center;gap:10px}
  .swatch{width:34px;height:34px;border-radius:8px;border:2px solid #2a6b4f;cursor:pointer}
  .picker{position:absolute;opacity:0;width:0;height:0;border:0;padding:0}
  .value{min-width:46px;text-align:right;opacity:.9}
  .toggle{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid #1f4b37;background:#0b1f17;border-radius:10px}
  .stack{display:flex;gap:10px;flex-wrap:wrap}
  .btn{background:linear-gradient(90deg,#20c997 0,#10b981 100%);color:#083a2b;border:none;border-radius:10px;padding:10px 14px;font-weight:900;cursor:pointer}
  .btn.alt{background:linear-gradient(90deg,#22c55e 0,#16a34a 100%)}
  .status{margin-top:8px;padding:10px;border-radius:10px;background:#0c2018;border:1px solid #214d39;display:none}
  .ok{color:#b8ffd6}.bad{color:#ffbbbb}.warn{color:#ffe3a6}
  .code{border-radius:10px;background:#0a1e17}
  #out{width:100%;min-height:90px;border:none;background:transparent;color:var(--ink);padding:12px;font-family:ui-monospace,Consolas,monospace;white-space:pre}
  iframe{width:100%;height:440px;border:none;border-radius:12px;margin-top:8px}
</style>
</head>
<body>
<header><h1>Grimoire of Reading ‚Äî —Ä–µ–¥–∞–∫—Ç–æ—Ä</h1></header>

<div class="wrap">

  <!-- –¢–µ–∫—Å—Ç -->
  <section class="card">
    <h2>–¢–µ–∫—Å—Ç</h2>
    <div class="row">
      <label class="lbl" for="title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
      <input id="title" value="Autumn Days">
    </div>
    <div class="row">
      <label class="lbl" for="text">–û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç</label>
      <textarea id="text" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç‚Ä¶">The days grow colder and the nights grow longer. Leaves change their colour ‚Äî from green to gold, orange, and red. The wind blows softly through the trees, making the branches sway. Children play outside, kicking leaves high into the air. Sometimes a cloud hides the pale sun, and rain begins to fall. In the evening, families stay inside, drinking hot cocoa and telling stories by the fire. Autumn is a time of change ‚Äî a bright and cosy season before the snow.</textarea>
    </div>
  </section>

  <div class="grid2">
    <!-- –®—Ä–∏—Ñ—Ç -->
    <section class="card">
      <h2>–®—Ä–∏—Ñ—Ç –∏ —Ü–≤–µ—Ç</h2>
      <div class="row">
        <label class="lbl" for="fontPreset">–ì–∞—Ä–Ω–∏—Ç—É—Ä–∞</label>
        <select id="fontPreset"></select>
      </div>
      <div class="row">
        <label class="lbl" for="fontSize">–†–∞–∑–º–µ—Ä (px)</label>
        <input type="number" id="fontSize" value="28" min="16" max="72">
      </div>
      <div class="row">
        <label class="lbl">–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
        <div class="sw">
          <div id="textColorBox" class="swatch"></div>
          <input id="textColor" class="picker" type="color" value="#fff8e1">
        </div>
      </div>
    </section>

    <!-- –ü–æ–¥—Å–≤–µ—Ç–∫–∞ -->
    <section class="card">
      <h2>–ü–æ–¥—Å–≤–µ—Ç–∫–∞</h2>
      <div class="row">
        <label class="lbl">–¶–≤–µ—Ç –ø–æ–¥—Å–≤–µ—Ç–∫–∏</label>
        <div class="sw">
          <div id="highlightColorBox" class="swatch"></div>
          <input id="highlightColor" class="picker" type="color" value="#ffd700">
        </div>
      </div>
      <div class="row">
        <label class="lbl" for="highlightOpacity">–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫–∏</label>
        <div style="display:flex;align-items:center;gap:10px">
          <input id="highlightOpacity" type="range" min="0" max="1" step="0.05" value="0.45" style="flex:1">
          <span id="hoVal" class="value">0.45</span>
        </div>
      </div>
      <div class="row">
        <label class="lbl" for="highlightStyle">–¢–∏–ø –ø–æ–¥—Å–≤–µ—Ç–∫–∏</label>
        <select id="highlightStyle">
          <option value="background" selected>–ü–æ–¥–ª–æ–∂–∫–∞</option>
          <option value="text">–¶–≤–µ—Ç –±—É–∫–≤</option>
        </select>
      </div>
    </section>
  </div>

  <div class="grid2">
    <!-- –§–æ–Ω –∏ —Ä–∞–º–∫–∞ -->
    <section class="card">
      <h2>–§–æ–Ω –∏ —Ä–∞–º–∫–∞</h2>
      <div class="row">
        <label class="lbl">–§–æ–Ω ‚Äî —Ü–≤–µ—Ç</label>
        <div class="sw">
          <div id="bgColorBox" class="swatch"></div>
          <input id="bgColor" class="picker" type="color" value="#0b271f">
        </div>
      </div>
      <div class="row">
        <label class="lbl" for="bgOpacity">–§–æ–Ω ‚Äî –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å</label>
        <div style="display:flex;align-items:center;gap:10px">
          <input id="bgOpacity" type="range" min="0" max="1" step="0.05" value="0.25" style="flex:1">
          <span id="boVal" class="value">0.25</span>
        </div>
      </div>
      <div class="row">
        <label class="lbl">–¶–≤–µ—Ç —Ä–∞–º–∫–∏</label>
        <div class="sw">
          <div id="borderColorBox" class="swatch"></div>
          <input id="borderColor" class="picker" type="color" value="#34d399">
        </div>
      </div>
      <div class="row">
        <label class="lbl" for="borderRadius">–°–∫—Ä—É–≥–ª–µ–Ω–∏–µ (0‚Äì1000)</label>
        <input type="number" id="borderRadius" min="0" max="1000" value="18">
      </div>
      <div class="row">
        <label class="lbl">–û–ø—Ü–∏–∏</label>
        <label class="toggle"><input type="checkbox" id="noBorder"> –±–µ–∑ —Ä–∞–º–∫–∏</label>
      </div>
    </section>

    <!-- –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ -->
    <section class="card">
      <h2>–í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ</h2>
      <div class="row">
        <label class="lbl" for="fw">–®–∏—Ä–∏–Ω–∞ iframe</label>
        <input type="number" id="fw" value="900" min="300" max="3000">
      </div>
      <div class="row">
        <label class="lbl" for="fh">–í—ã—Å–æ—Ç–∞ iframe</label>
        <input type="number" id="fh" value="520" min="200" max="3000">
      </div>
      <div class="row">
        <label class="lbl">–†–∞–∑—Ä–µ—à–µ–Ω–∏—è</label>
        <div class="stack">
          <label class="toggle"><input type="checkbox" id="allowMic" checked> microphone</label>
          <label class="toggle"><input type="checkbox" id="allowAutoplay" checked> autoplay</label>
          <label class="toggle"><input type="checkbox" id="allowFs" checked> allowfullscreen</label>
          <label class="toggle"><input type="checkbox" id="cacheBust"> –æ–±—Ö–æ–¥ –∫–µ—à–∞</label>
        </div>
      </div>

      <div class="stack" style="margin-top:8px">
        <button class="btn" id="genBtn" type="button">üîÆ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å IFRAME</button>
        <button class="btn alt" id="publishBtn" type="button">üß™ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
      </div>
      <div class="status" id="status"></div>
    </section>
  </div>

  <section class="card">
    <h2>–ö–æ–¥ –∏ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h2>
    <div class="code"><textarea id="out" readonly></textarea></div>
    <iframe id="preview" allow="microphone; autoplay"></iframe>
  </section>
</div>

<script>
/* ===== –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ ===== */
const BASE_MAIN   = "https://nikashum93.github.io/readingtrainer/main.html";
const ENDPOINT    = "https://server-kjnn.onrender.com/publish";
const PUBLISH_KEY = "nika_read_pub_2025";

/* ===== –±–æ–ª—å—à–æ–π —Å–ø–∏—Å–æ–∫ —à—Ä–∏—Ñ—Ç–æ–≤ ===== */
const FONTS = [
  {group:'–ß–∏—Ç–∞–±–µ–ª—å–Ω—ã–µ (UI, –∫–∏—Ä–∏–ª–ª–∏—Ü–∞)', items:[
    {name:'Inter', css:"'Inter', system-ui, Arial, sans-serif", gf:"family=Inter:wght@400;700&display=swap"},
    {name:'Roboto', css:"'Roboto', Arial, sans-serif", gf:"family=Roboto:wght@400;700&display=swap"},
    {name:'Montserrat', css:"'Montserrat', Arial, sans-serif", gf:"family=Montserrat:wght@400;700&display=swap"},
    {name:'Nunito', css:"'Nunito', Arial, sans-serif", gf:"family=Nunito:wght@400;700&display=swap"},
    {name:'Rubik', css:"'Rubik', Arial, sans-serif", gf:"family=Rubik:wght@400;700&display=swap"},
    {name:'PT Sans', css:"'PT Sans', Arial, sans-serif", gf:"family=PT+Sans:wght@400;700&display=swap"},
    {name:'Source Sans 3', css:"'Source Sans 3', Arial, sans-serif", gf:"family=Source+Sans+3:wght@400;700&display=swap"},
    {name:'Ubuntu', css:"'Ubuntu', Arial, sans-serif", gf:"family=Ubuntu:wght@400;700&display=swap"},
    {name:'Fira Sans', css:"'Fira Sans', Arial, sans-serif", gf:"family=Fira+Sans:wght@400;700&display=swap"}
  ]},
  {group:'–°–µ—Ä–∏—Ñ (–∫–Ω–∏–≥–∏, –∫–∏—Ä–∏–ª–ª–∏—Ü–∞)', items:[
    {name:'Merriweather', css:"'Merriweather', Georgia, serif", gf:"family=Merriweather:wght@400;700&display=swap"},
    {name:'PT Serif', css:"'PT Serif', Georgia, serif", gf:"family=PT+Serif:wght@400;700&display=swap"},
    {name:'Playfair Display', css:"'Playfair Display', Georgia, serif", gf:"family=Playfair+Display:wght@400;700&display=swap"},
    {name:'Literata', css:"'Literata', Georgia, serif", gf:"family=Literata:wght@400;700&display=swap"}
  ]},
  {group:'–†—É–∫–æ–ø–∏—Å–Ω—ã–µ (–µ—Å—Ç—å –∫–∏—Ä–∏–ª–ª–∏—Ü–∞)', items:[
    {name:'Caveat', css:"'Caveat', cursive", gf:"family=Caveat:wght@400;700&display=swap"},
    {name:'Marck Script', css:"'Marck Script', cursive", gf:"family=Marck+Script&display=swap"},
    {name:'Neucha', css:"'Neucha', cursive", gf:"family=Neucha&display=swap"},
    {name:'Pacifico', css:"'Pacifico', cursive", gf:"family=Pacifico&display=swap"},
    {name:'Lobster', css:"'Lobster', cursive", gf:"family=Lobster&display=swap"},
    {name:'Comfortaa', css:"'Comfortaa', cursive", gf:"family=Comfortaa:wght@400;700&display=swap"}
  ]},
  {group:'–ú—É–ª—å—Ç—è—à–Ω—ã–µ / Display', items:[
    {name:'Fredoka', css:"'Fredoka', 'Montserrat', sans-serif", gf:"family=Fredoka:wght@400;700&display=swap"},
    {name:'Baloo 2', css:"'Baloo 2', cursive", gf:"family=Baloo+2:wght@400;700&display=swap"},
    {name:'Bangers (–ª–∞—Ç.)', css:"'Bangers', cursive", gf:"family=Bangers&display=swap"},
    {name:'Chewy (–ª–∞—Ç.)', css:"'Chewy', cursive", gf:"family=Chewy&display=swap"},
    {name:'Amatic SC (–ª–∞—Ç.)', css:"'Amatic SC', cursive", gf:"family=Amatic+SC:wght@400;700&display=swap"}
  ]},
  {group:'–û—Å–æ–±—ã–µ / –ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–µ', items:[
    {name:'Cinzel Decorative', css:"'Cinzel Decorative', serif", gf:"family=Cinzel+Decorative:wght@400;700&display=swap"},
    {name:'IM Fell English', css:"'IM Fell English', serif", gf:"family=IM+Fell+English:ital@0;1&display=swap"},
    {name:'UnifrakturCook (–ª–∞—Ç.)', css:"'UnifrakturCook', serif", gf:"family=UnifrakturCook:wght@700&display=swap"}
  ]},
  {group:'–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å / –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å', items:[
    {name:'Atkinson Hyperlegible', css:"'Atkinson Hyperlegible', Arial, sans-serif", gf:"family=Atkinson+Hyperlegible:wght@400;700&display=swap"},
    {name:'Lexend', css:"'Lexend', Arial, sans-serif", gf:"family=Lexend:wght@400;700&display=swap"}
  ]},
  {group:'–í–æ—Å—Ç–æ—á–Ω—ã–µ (JP/KR/ZH)', items:[
    {name:'Noto Sans JP', css:"'Noto Sans JP','Hiragino Kaku Gothic Pro','Meiryo',sans-serif", gf:"family=Noto+Sans+JP:wght@400;700&display=swap"},
    {name:'Noto Serif JP', css:"'Noto Serif JP','Hiragino Mincho Pro',serif", gf:"family=Noto+Serif+JP:wght@400;700&display=swap"},
    {name:'Noto Sans KR', css:"'Noto Sans KR','Malgun Gothic',sans-serif", gf:"family=Noto+Sans+KR:wght@400;700&display=swap"},
    {name:'Noto Sans SC (ÁÆÄ‰Ωì‰∏≠Êñá)', css:"'Noto Sans SC','PingFang SC','Microsoft YaHei',sans-serif", gf:"family=Noto+Sans+SC:wght@400;700&display=swap"}
  ]},
  {group:'–ü–∏—Å—å–º–µ–Ω–Ω–æ—Å—Ç–∏ –º–∏—Ä–∞', items:[
    {name:'Noto Naskh Arabic', css:"'Noto Naskh Arabic','Amiri',serif", gf:"family=Noto+Naskh+Arabic:wght@400;700&display=swap"},
    {name:'Amiri (Arabic)', css:"'Amiri', serif", gf:"family=Amiri:wght@400;700&display=swap"},
    {name:'Noto Sans Hebrew', css:"'Noto Sans Hebrew','Rubik',sans-serif", gf:"family=Noto+Sans+Hebrew:wght@400;700&display=swap"},
    {name:'Noto Sans Devanagari', css:"'Noto Sans Devanagari','Hind',sans-serif", gf:"family=Noto+Sans+Devanagari:wght@400;700&display=swap"},
    {name:'Noto Sans Georgian', css:"'Noto Sans Georgian',sans-serif", gf:"family=Noto+Sans+Georgian:wght@400;700&display=swap"}
  ]},
  {group:'–°–∏—Å—Ç–µ–º–Ω—ã–µ (–±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏)', items:[
    {name:'System UI', css:"system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif", gf:""},
    {name:'Georgia (serif)', css:"Georgia, serif", gf:""},
    {name:'Arial (sans)', css:"Arial, Helvetica, sans-serif", gf:""},
    {name:'Times New Roman', css:"'Times New Roman', Times, serif", gf:""}
  ]}
];

const $ = id => document.getElementById(id);
(function fillFonts(){
  FONTS.forEach(group=>{
    const og=document.createElement('optgroup'); og.label=group.group;
    group.items.forEach(f=>{
      const o=document.createElement('option'); o.textContent=f.name; o.value=f.css; o.dataset.gf=f.gf||"";
      og.appendChild(o);
    });
    $('fontPreset').appendChild(og);
  });
  $('fontPreset').selectedIndex=0;
})();
function loadFont(){
  const opt=$('fontPreset').options[$('fontPreset').selectedIndex];
  $('gfLink').href = opt.dataset.gf ? "https://fonts.googleapis.com/css2?"+opt.dataset.gf : "";
}

/* ===== helpers ===== */
const showVal=(id,val)=>$(id).textContent=(+val).toFixed(2);
function bindSwatch(boxId,inputId){ const b=$(boxId),i=$(inputId); b.style.background=i.value; b.addEventListener('click',()=>i.showPicker?i.showPicker():i.click()); i.addEventListener('input',()=>b.style.background=i.value); }
['textColor','highlightColor','bgColor','borderColor'].forEach(id=>bindSwatch(id+'Box',id));
$('highlightOpacity').addEventListener('input',e=>showVal('hoVal',e.target.value));
$('bgOpacity').addEventListener('input',e=>showVal('boVal',e.target.value));

/* ===== URL + preview ===== */
function buildURL(){
  const border=$('noBorder').checked?'none':'solid';
  const p=new URLSearchParams({
    title:$('title').value,
    text:$('text').value,
    fontFamily:$('fontPreset').value,
    fontSize:String(parseInt($('fontSize').value)||28),
    textColor:$('textColor').value,
    titleColor:$('highlightColor').value,
    highlightColor:$('highlightColor').value,
    highlightOpacity:String(parseFloat($('highlightOpacity').value)||0.45),
    highlightStyle:$('highlightStyle').value,
    bgColor:$('bgColor').value,
    bgOpacity:String(parseFloat($('bgOpacity').value)||0.25),
    border,
    borderColor:$('borderColor').value,
    borderRadius:String(parseInt($('borderRadius').value)||18)
  });
  if(!p.get('text') || !p.get('text').trim()){ p.delete('text'); }
  let src=`${BASE_MAIN}?${p.toString()}`;
  if($('cacheBust').checked) src+=`&v=${Date.now()}`;
  return src;
}
function render(){
  const src=buildURL();
  $('preview').src=src;
  const allow=[ $('allowMic').checked?'microphone':'', $('allowAutoplay').checked?'autoplay':'' ].filter(Boolean).join('; ');
  const allowAttr=allow?` allow="${allow}"`:'';
  const fsAttr=$('allowFs').checked?' allowfullscreen':'';
  $('out').value=`<iframe src="${src}" width="${$('fw').value}" height="${$('fh').value}" style="border:none;border-radius:16px;overflow:hidden;"${allowAttr}${fsAttr}></iframe>`;
}
$('genBtn').addEventListener('click',render);
$('fontPreset').addEventListener('change',()=>{loadFont(); render();});
document.addEventListener('DOMContentLoaded',()=>{loadFont(); showVal('hoVal',$('highlightOpacity').value); showVal('boVal',$('bgOpacity').value); render();});

/* ===== –ø—É–±–ª–∏–∫–∞—Ü–∏—è ===== */
const statusBox=$('status');
function setStatus(h,c=''){statusBox.style.display='block';statusBox.className='status '+c;statusBox.innerHTML=h;}
function slug(s){return (s||'untitled').toLowerCase().normalize('NFKD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'').slice(0,40)||'note'}
function stamp(){const d=new Date(),p=n=>String(n).padStart(2,'0');return`${d.getFullYear()}${p(d.getMonth()+1)}${p(d.getDate())}-${p(d.getHours())}${p(d.getMinutes())}${p(d.getSeconds())}`}

async function publish(){
  try{
    setStatus('üîÆ –ü—É–±–ª–∏–∫—É—é‚Ä¶','warn');
    const border=$('noBorder').checked?'none':'solid';
    const data={
      title:$('title').value,
      text:$('text').value,
      fontFamily:$('fontPreset').value,
      fontSize:parseInt($('fontSize').value)||28,
      textColor:$('textColor').value,
      titleColor:$('highlightColor').value,
      highlightColor:$('highlightColor').value,
      highlightOpacity:parseFloat($('highlightOpacity').value)||0.45,
      highlightStyle:$('highlightStyle').value,
      bgColor:$('bgColor').value,
      bgOpacity:parseFloat($('bgOpacity').value)||0.25,
      border,
      borderColor:$('borderColor').value,
      borderRadius:parseInt($('borderRadius').value)||18
    };
    const id=`${slug(data.title)}-${stamp()}`;
    const res=await fetch(ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json','X-Publish-Key':PUBLISH_KEY},body:JSON.stringify({id,mode:'json',folder:'data',content:JSON.stringify(data,null,2)})});
    if(!res.ok){const t=await res.text().catch(()=> '');throw new Error(res.status+' '+res.statusText+(t?': '+t:''));}
    const src=`${BASE_MAIN}?id=${encodeURIComponent(id)}&v=${Date.now()}`;
    $('preview').src=src;
    const allow=[ $('allowMic').checked?'microphone':'', $('allowAutoplay').checked?'autoplay':'' ].filter(Boolean).join('; ');
    const allowAttr=allow?` allow="${allow}"`:'';
    const fsAttr=$('allowFs').checked?' allowfullscreen':'';
    $('out').value=`<iframe src="${src}" width="${$('fw').value}" height="${$('fh').value}" style="border:none;border-radius:16px;overflow:hidden;"${allowAttr}${fsAttr}></iframe>`;
    setStatus('‚úÖ –ì–æ—Ç–æ–≤–æ! –ó–∞–¥–∞–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ.','ok');
  }catch(e){ setStatus('‚ò† –û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: '+e.message,'bad'); }
}
$('publishBtn').addEventListener('click',publish);
</script>
</body>
</html>
