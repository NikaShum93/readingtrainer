<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–¢—Ä–µ–Ω–∞–∂—ë—Ä –ø–æ —á—Ç–µ–Ω–∏—é by Nika Shum</title>
<style>
  body {
    margin: 0; padding: 0;
    display: flex; flex-direction: column;
    align-items: center; justify-content: flex-start;
    font-family: sans-serif;
    background: transparent;
    color: var(--text-color, #fff8e1);
  }
  .player {
    display: flex; align-items: center; gap: 10px;
    background: rgba(0,0,0,0.3);
    padding: 8px 12px;
    border-radius: 12px;
    margin: 10px;
  }
  .player button {
    background: none; border: none; cursor: pointer;
    font-size: 22px; color: var(--text-color, #fff8e1);
    opacity: 0.7;
  }
  .player button.active { opacity: 1; }
  .content {
    max-width: 800px; padding: 20px; 
    border: var(--border-width, 2px) solid var(--border-color, transparent);
    border-radius: var(--border-radius, 0px);
    background: var(--bg-color, transparent);
  }
  h1 { text-align: center; font-weight: bold; }
  mark {
    background-color: var(--highlight-color, yellow);
    opacity: var(--highlight-opacity, 1);
    padding: 0 2px;
  }
</style>
</head>
<body>

<div class="player">
  <button id="playBtn" title="Play">‚ñ∂Ô∏è</button>
  <button id="pauseBtn" title="Pause">‚è∏Ô∏è</button>
  <button id="stopBtn" title="Stop">‚èπÔ∏è</button>
  <button id="openBtn" title="–û—Ç–∫—Ä—ã—Ç—å" disabled>üìÇ</button>
  <button id="downloadBtn" title="–°–∫–∞—á–∞—Ç—å" disabled>üíæ</button>
</div>

<div class="content">
  <h1 id="title"></h1>
  <p id="text"></p>
</div>

<script>
const urlParams = new URLSearchParams(window.location.search);
const dataUrl = urlParams.get('data');

const titleEl = document.getElementById('title');
const textEl = document.getElementById('text');

let audioBlob = null;
let audioUrl = null;
let audio = null;

// –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏
document.documentElement.style.setProperty('--text-color', urlParams.get('textColor') || '#fff8e1');
document.documentElement.style.setProperty('--highlight-color', urlParams.get('highlightColor') || '#ffd700');
document.documentElement.style.setProperty('--highlight-opacity', urlParams.get('highlightOpacity') || '0.7');
document.documentElement.style.setProperty('--bg-color', hexToRgba(urlParams.get('bgColor') || '#000000', urlParams.get('bgOpacity') || 0));
document.documentElement.style.setProperty('--border-color', urlParams.get('borderColor') || 'transparent');
document.documentElement.style.setProperty('--border-width', urlParams.get('border') === 'none' ? '0px' : '2px');
document.documentElement.style.setProperty('--border-radius', (urlParams.get('borderRadius') || 0) + 'px');

function hexToRgba(hex, opacity) {
  const bigint = parseInt(hex.replace('#', ''), 16);
  const r = (bigint >> 16) & 255;
  const g = (bigint >> 8) & 255;
  const b = bigint & 255;
  return `rgba(${r},${g},${b},${opacity})`;
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—Å—Ç
fetch(dataUrl)
  .then(res => res.json())
  .then(data => {
    titleEl.textContent = data.title;
    textEl.innerHTML = data.text;
  });

document.getElementById('playBtn').addEventListener('click', () => {
  if (audioUrl) {
    audio = new Audio(audioUrl);
    audio.play();
  }
});
document.getElementById('pauseBtn').addEventListener('click', () => {
  if (audio) audio.pause();
});
document.getElementById('stopBtn').addEventListener('click', () => {
  if (audio) { audio.pause(); audio.currentTime = 0; }
});

// –û—Ç–∫—Ä—ã—Ç—å / –°–∫–∞—á–∞—Ç—å
document.getElementById('openBtn').addEventListener('click', () => {
  if (audioUrl) window.open(audioUrl, '_blank');
});
document.getElementById('downloadBtn').addEventListener('click', () => {
  if (audioBlob) {
    const a = document.createElement('a');
    a.href = audioUrl;
    a.download = 'recording.webm';
    a.click();
  }
});
</script>
</body>
</html>
